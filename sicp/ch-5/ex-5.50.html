<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>SICP Solutions</title>
	<link rel="stylesheet" href="https://www.inchmeal.io/assets/css/styles_inchmeal.css"/>
	<link rel="alternate" type="application/rss+xml" title="Inchmeal RSS" href="/rss-feed.xml" />

	<script src="https://www.inchmeal.io/assets/js/inchmeal_head.js"></script>

	
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			"HTML-CSS": {
				linebreaks: { automatic: true },
				scale: 82,
				styles: {
					".MathJax_Display": {
						"font-size": "105%" //first scale is applied than this is applied on display only because we are using display selector.
					},
					"p .MathJax": { //For inline
						//"background-color": "#FFFF88",
						//color:   "#CC0000",
					}	
				}
			},
			"displayAlign": "left",
			TeX: { 
				equationNumbers: { 
					autoNumber: "AMS" 
				},
				Macros: {
					Exp: "{\\operatorname{\\mathrm{E}}}",
					Var: "{\\operatorname{\\mathrm{Var}}}",
					Cov: "{\\operatorname{\\mathrm{Cov}}}",
					Abs: ['\\left\\lvert #2 \\right\\rvert_{\\text{#1}}', 2, ""],
					Prn: ['\\left( #2 \\right)_{\\text{#1}}', 2, ""]
				}
			}
		});
	</script>
	
	<script type="text/javascript"
			src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
	
	

	<meta name="google-site-verification" content="tCrxTm0EXch-6c8nlJPb_Cq-BOBcK9GR2ZP3I1lfLKs" />
	
	<meta name="description" content="Inchmeal | This page contains solutions for Structure and Interpretation of Computer Programs, SICP"/>

	

	



	
	<link rel="icon" sizes="32x32" href="https://www.inchmeal.io/assets/img/favicon-32x32.png">




	
	<link rel="icon" sizes="192x192" href="https://www.inchmeal.io/assets/img/touch-icon-192x192.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="https://www.inchmeal.io/assets/img/apple-touch-icon-180x180-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.inchmeal.io/assets/img/apple-touch-icon-152x152-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.inchmeal.io/assets/img/apple-touch-icon-144x144-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.inchmeal.io/assets/img/apple-touch-icon-120x120-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.inchmeal.io/assets/img/apple-touch-icon-114x114-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.inchmeal.io/assets/img/apple-touch-icon-76x76-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.inchmeal.io/assets/img/apple-touch-icon-72x72-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" href="https://www.inchmeal.io/assets/img/apple-touch-icon-precomposed.png">	




	
	<meta name="msapplication-TileImage" content="https://www.inchmeal.io/assets/img/msapplication_tileimage.png"/>




	
	<meta name="msapplication-TileColor" content="#fabb00">



	<!-- Facebook Optimization -->
	<meta property="og:locale" content="en_EN" />
	
	<meta property="og:title" content="SICP Solutions" />
	<meta property="og:description" content="Inchmeal | This page contains solutions for Structure and Interpretation of Computer Programs, SICP"/>
	<meta property="og:url" content="https://www.inchmeal.io//sicp/ch-5/ex-5.50.html" />
	<meta property="og:site_name" content="inchmeal" />
	

	

	<!-- Search Engine Optimization -->
	

	<link type="text/plain" rel="author" href="https://www.inchmeal.io//humans.txt" />

	
</head>

<body id="top-of-page" class="">
	
<div id="navigation" class="sticky">
  <nav class="top-bar" data-topbar>
    <ul class="title-area">
      <li class="name">
        <h1>
          <a href="https://www.inchmeal.io">
            <img src="https://www.inchmeal.io/assets/img/logo.png"/>
          </a>
        </h1>
      </li>
       <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu"(text inside span) to just have icon alone -->
      <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
    </ul>
    <section class="top-bar-section">

      <ul class="right">
        

              

          
          
              <li class="divider"></li>
              <li><a href="https://www.inchmeal.io/">home</a></li>
          
        

              

          
          
              <li class="divider"></li>
              <li><a href="https://www.inchmeal.io/archives/">archives</a></li>
          
        

              

          
          
              <li class="divider"></li>
              <li><a href="https://www.inchmeal.io/about/">about</a></li>
          
        
        
      </ul>

      <ul class="left">
        <li class="divider"></li>
        

              

          
          
        

              

          
          
        

              

          
          
        
        
      </ul>
    </section>
  </nav>
</div><!-- /#navigation -->


	<!-- capture chapters -IMPORTANT- do not split below statement as it starts capturing new line which causes problems- -->





<!-- remove duplicates, convert to num and insert in array -->

    
    

    

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
            
            

    

    
    

    
        
    

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
    

    

    
    

    
        
    
        
    
        
    

    

    
    

    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    

    
    

    
        
    
        
    
        
    
        
            
            

    




<div class="row t30">
    <div class="medium-4 columns medium-push-8">
    </div>
    <div class="medium-8 columns medium-pull-4">
        <div class="row">
            <div class="medium-11 medium-offset-1 columns">
            <h1><a href="/sicp/index.html" >SICP Solutions</a></h1>
            </div>
        </div>
    </div>
</div>

<div class="row t10">
    <div class="medium-3 columns medium-push-9">
        <div class="row t5">
            <div class="medium-12 columns">

                <ul class="accordion" data-accordion>
                    

                    
                    

                    <li class="accordion-navigation">
                        <a href="#ch-1">Chapter 1</a>
                        
                        <div id="ch-1" class="content ">
                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/notes.html" ><span class="radius info label  icon-edit"></span></a>
                            

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.1.html" ><span class="radius info label ">1.1</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.2.html" ><span class="radius info label ">1.2</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.3.html" ><span class="radius info label ">1.3</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.4.html" ><span class="radius info label ">1.4</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.5.html" ><span class="radius info label ">1.5</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.6.html" ><span class="radius info label ">1.6</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.7.html" ><span class="radius info label ">1.7</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.8.html" ><span class="radius info label ">1.8</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.9.html" ><span class="radius info label ">1.9</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.10.html" ><span class="radius info label ">1.10</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.11.html" ><span class="radius info label ">1.11</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.12.html" ><span class="radius info label ">1.12</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.13.html" ><span class="radius info label ">1.13</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.14.html" ><span class="radius info label todo">1.14</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.15.html" ><span class="radius info label ">1.15</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.16.html" ><span class="radius info label ">1.16</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.17.html" ><span class="radius info label ">1.17</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.18.html" ><span class="radius info label ">1.18</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.19.html" ><span class="radius info label ">1.19</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.20.html" ><span class="radius info label ">1.20</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.21.html" ><span class="radius info label ">1.21</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.22.html" ><span class="radius info label ">1.22</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.23.html" ><span class="radius info label ">1.23</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.24.html" ><span class="radius info label ">1.24</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.25.html" ><span class="radius info label ">1.25</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.26.html" ><span class="radius info label ">1.26</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.27.html" ><span class="radius info label ">1.27</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.28.html" ><span class="radius info label ">1.28</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.29.html" ><span class="radius info label ">1.29</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.30.html" ><span class="radius info label ">1.30</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.31.html" ><span class="radius info label ">1.31</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.32.html" ><span class="radius info label ">1.32</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.33.html" ><span class="radius info label ">1.33</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.34.html" ><span class="radius info label ">1.34</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.35.html" ><span class="radius info label ">1.35</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.36.html" ><span class="radius info label ">1.36</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.37.html" ><span class="radius info label ">1.37</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.38.html" ><span class="radius info label ">1.38</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.39.html" ><span class="radius info label ">1.39</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.40.html" ><span class="radius info label ">1.40</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.41.html" ><span class="radius info label ">1.41</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.42.html" ><span class="radius info label ">1.42</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.43.html" ><span class="radius info label ">1.43</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.44.html" ><span class="radius info label ">1.44</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.45.html" ><span class="radius info label ">1.45</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-1/ex-1.46.html" ><span class="radius info label ">1.46</span></a>
							

                            
                        </div>
                    </li>
                    

                    
                    

                    <li class="accordion-navigation">
                        <a href="#ch-2">Chapter 2</a>
                        
                        <div id="ch-2" class="content ">
                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/notes.html" ><span class="radius info label  icon-edit"></span></a>
                            

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.1.html" ><span class="radius info label ">2.1</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.2.html" ><span class="radius info label ">2.2</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.3.html" ><span class="radius info label ">2.3</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.4.html" ><span class="radius info label ">2.4</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.5.html" ><span class="radius info label ">2.5</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.6.html" ><span class="radius info label ">2.6</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.7.html" ><span class="radius info label ">2.7</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.8.html" ><span class="radius info label ">2.8</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.9.html" ><span class="radius info label ">2.9</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.10.html" ><span class="radius info label ">2.10</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.11.html" ><span class="radius info label ">2.11</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.12.html" ><span class="radius info label ">2.12</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.13.html" ><span class="radius info label ">2.13</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.14.html" ><span class="radius info label ">2.14</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.15.html" ><span class="radius info label ">2.15</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.16.html" ><span class="radius info label todo">2.16</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.17.html" ><span class="radius info label ">2.17</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.18.html" ><span class="radius info label ">2.18</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.19.html" ><span class="radius info label ">2.19</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.20.html" ><span class="radius info label ">2.20</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.21.html" ><span class="radius info label ">2.21</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.22.html" ><span class="radius info label ">2.22</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.23.html" ><span class="radius info label ">2.23</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.24.html" ><span class="radius info label ">2.24</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.25.html" ><span class="radius info label ">2.25</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.26.html" ><span class="radius info label ">2.26</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.27.html" ><span class="radius info label ">2.27</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.28.html" ><span class="radius info label ">2.28</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.29.html" ><span class="radius info label ">2.29</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.30.html" ><span class="radius info label ">2.30</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.31.html" ><span class="radius info label ">2.31</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.32.html" ><span class="radius info label ">2.32</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.33.html" ><span class="radius info label ">2.33</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.34.html" ><span class="radius info label ">2.34</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.35.html" ><span class="radius info label ">2.35</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.36.html" ><span class="radius info label ">2.36</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.37.html" ><span class="radius info label ">2.37</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.38.html" ><span class="radius info label ">2.38</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.39.html" ><span class="radius info label ">2.39</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.40.html" ><span class="radius info label ">2.40</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.41.html" ><span class="radius info label ">2.41</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.42.html" ><span class="radius info label ">2.42</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.43.html" ><span class="radius info label ">2.43</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.44.html" ><span class="radius info label ">2.44</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.45.html" ><span class="radius info label ">2.45</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.46.html" ><span class="radius info label ">2.46</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.47.html" ><span class="radius info label ">2.47</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.48.html" ><span class="radius info label ">2.48</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.49.html" ><span class="radius info label ">2.49</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.50.html" ><span class="radius info label ">2.50</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.51.html" ><span class="radius info label ">2.51</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.52.html" ><span class="radius info label ">2.52</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.53.html" ><span class="radius info label ">2.53</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.54.html" ><span class="radius info label ">2.54</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.55.html" ><span class="radius info label ">2.55</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.56.html" ><span class="radius info label ">2.56</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.57.html" ><span class="radius info label ">2.57</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.58.html" ><span class="radius info label ">2.58</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.59.html" ><span class="radius info label ">2.59</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.60.html" ><span class="radius info label ">2.60</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.61.html" ><span class="radius info label ">2.61</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.62.html" ><span class="radius info label ">2.62</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.63.html" ><span class="radius info label ">2.63</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.64.html" ><span class="radius info label ">2.64</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.65.html" ><span class="radius info label ">2.65</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.66.html" ><span class="radius info label ">2.66</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.67.html" ><span class="radius info label ">2.67</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.68.html" ><span class="radius info label ">2.68</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.69.html" ><span class="radius info label ">2.69</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.70.html" ><span class="radius info label ">2.70</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.71.html" ><span class="radius info label ">2.71</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.72.html" ><span class="radius info label ">2.72</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.73.html" ><span class="radius info label ">2.73</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.74.html" ><span class="radius info label ">2.74</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.75.html" ><span class="radius info label ">2.75</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.76.html" ><span class="radius info label ">2.76</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.77.html" ><span class="radius info label ">2.77</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.78.html" ><span class="radius info label ">2.78</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.79.html" ><span class="radius info label ">2.79</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.80.html" ><span class="radius info label ">2.80</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.81.html" ><span class="radius info label ">2.81</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.82.html" ><span class="radius info label ">2.82</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.83.html" ><span class="radius info label ">2.83</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.84.html" ><span class="radius info label ">2.84</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.85.html" ><span class="radius info label ">2.85</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.86.html" ><span class="radius info label ">2.86</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.87.html" ><span class="radius info label ">2.87</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.88.html" ><span class="radius info label ">2.88</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.89.html" ><span class="radius info label ">2.89</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.90.html" ><span class="radius info label ">2.90</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.91.html" ><span class="radius info label ">2.91</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.92.html" ><span class="radius info label ">2.92</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.93.html" ><span class="radius info label ">2.93</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.94.html" ><span class="radius info label ">2.94</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.95.html" ><span class="radius info label ">2.95</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.96.html" ><span class="radius info label ">2.96</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-2/ex-2.97.html" ><span class="radius info label ">2.97</span></a>
							

                            
                        </div>
                    </li>
                    

                    
                    

                    <li class="accordion-navigation">
                        <a href="#ch-3">Chapter 3</a>
                        
                        <div id="ch-3" class="content ">
                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/notes.html" ><span class="radius info label  icon-edit"></span></a>
                            

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.1.html" ><span class="radius info label ">3.1</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.2.html" ><span class="radius info label ">3.2</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.3.html" ><span class="radius info label ">3.3</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.4.html" ><span class="radius info label ">3.4</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.5.html" ><span class="radius info label ">3.5</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.6.html" ><span class="radius info label ">3.6</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.7.html" ><span class="radius info label ">3.7</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.8.html" ><span class="radius info label ">3.8</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.9.html" ><span class="radius info label ">3.9</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.10.html" ><span class="radius info label ">3.10</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.11.html" ><span class="radius info label ">3.11</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.12.html" ><span class="radius info label ">3.12</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.13.html" ><span class="radius info label ">3.13</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.14.html" ><span class="radius info label ">3.14</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.15.html" ><span class="radius info label todo">3.15</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.16.html" ><span class="radius info label ">3.16</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.17.html" ><span class="radius info label ">3.17</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.18.html" ><span class="radius info label ">3.18</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.19.html" ><span class="radius info label ">3.19</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.20.html" ><span class="radius info label todo">3.20</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.21.html" ><span class="radius info label ">3.21</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.22.html" ><span class="radius info label ">3.22</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.23.html" ><span class="radius info label ">3.23</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.24.html" ><span class="radius info label ">3.24</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.25.html" ><span class="radius info label ">3.25</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.26.html" ><span class="radius info label ">3.26</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.27.html" ><span class="radius info label ">3.27</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.28.html" ><span class="radius info label ">3.28</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.29.html" ><span class="radius info label ">3.29</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.30.html" ><span class="radius info label ">3.30</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.31.html" ><span class="radius info label ">3.31</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.32.html" ><span class="radius info label ">3.32</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.33.html" ><span class="radius info label ">3.33</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.34.html" ><span class="radius info label ">3.34</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.35.html" ><span class="radius info label ">3.35</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.36.html" ><span class="radius info label todo">3.36</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.37.html" ><span class="radius info label ">3.37</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.38.html" ><span class="radius info label ">3.38</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.39.html" ><span class="radius info label ">3.39</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.40.html" ><span class="radius info label ">3.40</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.41.html" ><span class="radius info label ">3.41</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.42.html" ><span class="radius info label ">3.42</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.43.html" ><span class="radius info label ">3.43</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.44.html" ><span class="radius info label ">3.44</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.45.html" ><span class="radius info label ">3.45</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.46.html" ><span class="radius info label ">3.46</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.47.html" ><span class="radius info label ">3.47</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.48.html" ><span class="radius info label ">3.48</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.49.html" ><span class="radius info label ">3.49</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.50.html" ><span class="radius info label ">3.50</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.51.html" ><span class="radius info label ">3.51</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.52.html" ><span class="radius info label ">3.52</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.53.html" ><span class="radius info label ">3.53</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.54.html" ><span class="radius info label ">3.54</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.55.html" ><span class="radius info label ">3.55</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.56.html" ><span class="radius info label ">3.56</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.57.html" ><span class="radius info label ">3.57</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.58.html" ><span class="radius info label ">3.58</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.59.html" ><span class="radius info label ">3.59</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.60.html" ><span class="radius info label ">3.60</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.61.html" ><span class="radius info label ">3.61</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.62.html" ><span class="radius info label ">3.62</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.63.html" ><span class="radius info label ">3.63</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.64.html" ><span class="radius info label ">3.64</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.65.html" ><span class="radius info label ">3.65</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.66.html" ><span class="radius info label ">3.66</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.67.html" ><span class="radius info label ">3.67</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.68.html" ><span class="radius info label ">3.68</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.69.html" ><span class="radius info label ">3.69</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.70.html" ><span class="radius info label ">3.70</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.71.html" ><span class="radius info label ">3.71</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.72.html" ><span class="radius info label ">3.72</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.73.html" ><span class="radius info label ">3.73</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.74.html" ><span class="radius info label ">3.74</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.75.html" ><span class="radius info label ">3.75</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.76.html" ><span class="radius info label ">3.76</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.77.html" ><span class="radius info label ">3.77</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.78.html" ><span class="radius info label ">3.78</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.79.html" ><span class="radius info label ">3.79</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.80.html" ><span class="radius info label ">3.80</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.81.html" ><span class="radius info label ">3.81</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-3/ex-3.82.html" ><span class="radius info label ">3.82</span></a>
							

                            
                        </div>
                    </li>
                    

                    
                    

                    <li class="accordion-navigation">
                        <a href="#ch-4">Chapter 4</a>
                        
                        <div id="ch-4" class="content ">
                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/notes.html" ><span class="radius info label  icon-edit"></span></a>
                            

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.1.html" ><span class="radius info label ">4.1</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.2.html" ><span class="radius info label ">4.2</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.3.html" ><span class="radius info label ">4.3</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.4.html" ><span class="radius info label ">4.4</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.5.html" ><span class="radius info label ">4.5</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.6.html" ><span class="radius info label ">4.6</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.7.html" ><span class="radius info label ">4.7</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.8.html" ><span class="radius info label ">4.8</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.9.html" ><span class="radius info label ">4.9</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.10.html" ><span class="radius info label todo">4.10</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.11.html" ><span class="radius info label ">4.11</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.12.html" ><span class="radius info label ">4.12</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.13.html" ><span class="radius info label ">4.13</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.14.html" ><span class="radius info label ">4.14</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.15.html" ><span class="radius info label ">4.15</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.16.html" ><span class="radius info label ">4.16</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.17.html" ><span class="radius info label ">4.17</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.18.html" ><span class="radius info label ">4.18</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.19.html" ><span class="radius info label ">4.19</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.20.html" ><span class="radius info label ">4.20</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.21.html" ><span class="radius info label ">4.21</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.22.html" ><span class="radius info label ">4.22</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.23.html" ><span class="radius info label ">4.23</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.24.html" ><span class="radius info label ">4.24</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.25.html" ><span class="radius info label ">4.25</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.26.html" ><span class="radius info label ">4.26</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.27.html" ><span class="radius info label ">4.27</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.28.html" ><span class="radius info label ">4.28</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.29.html" ><span class="radius info label ">4.29</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.30.html" ><span class="radius info label ">4.30</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.31.html" ><span class="radius info label ">4.31</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.32.html" ><span class="radius info label ">4.32</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.33.html" ><span class="radius info label ">4.33</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.34.html" ><span class="radius info label ">4.34</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.35.html" ><span class="radius info label ">4.35</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.36.html" ><span class="radius info label ">4.36</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.37.html" ><span class="radius info label ">4.37</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.38.html" ><span class="radius info label ">4.38</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.39.html" ><span class="radius info label ">4.39</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.40.html" ><span class="radius info label ">4.40</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.41.html" ><span class="radius info label ">4.41</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.42.html" ><span class="radius info label ">4.42</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.43.html" ><span class="radius info label ">4.43</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.44.html" ><span class="radius info label ">4.44</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.45.html" ><span class="radius info label ">4.45</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.46.html" ><span class="radius info label ">4.46</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.47.html" ><span class="radius info label ">4.47</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.48.html" ><span class="radius info label ">4.48</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.49.html" ><span class="radius info label ">4.49</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.50.html" ><span class="radius info label ">4.50</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.51.html" ><span class="radius info label ">4.51</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.52.html" ><span class="radius info label ">4.52</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.53.html" ><span class="radius info label ">4.53</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.54.html" ><span class="radius info label ">4.54</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.55.html" ><span class="radius info label ">4.55</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.56.html" ><span class="radius info label ">4.56</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.57.html" ><span class="radius info label ">4.57</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.58.html" ><span class="radius info label ">4.58</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.59.html" ><span class="radius info label ">4.59</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.60.html" ><span class="radius info label ">4.60</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.61.html" ><span class="radius info label ">4.61</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.62.html" ><span class="radius info label ">4.62</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.63.html" ><span class="radius info label ">4.63</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.64.html" ><span class="radius info label ">4.64</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.65.html" ><span class="radius info label ">4.65</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.66.html" ><span class="radius info label ">4.66</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.67.html" ><span class="radius info label ">4.67</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.68.html" ><span class="radius info label ">4.68</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.69.html" ><span class="radius info label ">4.69</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.70.html" ><span class="radius info label ">4.70</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.71.html" ><span class="radius info label ">4.71</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.72.html" ><span class="radius info label ">4.72</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.73.html" ><span class="radius info label ">4.73</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.74.html" ><span class="radius info label ">4.74</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.75.html" ><span class="radius info label ">4.75</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.76.html" ><span class="radius info label ">4.76</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.77.html" ><span class="radius info label ">4.77</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.78.html" ><span class="radius info label ">4.78</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-4/ex-4.79.html" ><span class="radius info label todo">4.79</span></a>
							

                            
                        </div>
                    </li>
                    

                    
                    

                    <li class="accordion-navigation">
                        <a href="#ch-5">Chapter 5</a>
                        
                        <div id="ch-5" class="content active">
                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/notes.html" ><span class="radius info label  icon-edit"></span></a>
                            

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.1.html" ><span class="radius info label ">5.1</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.2.html" ><span class="radius info label ">5.2</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.3.html" ><span class="radius info label ">5.3</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.4.html" ><span class="radius info label ">5.4</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.5.html" ><span class="radius info label ">5.5</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.6.html" ><span class="radius info label ">5.6</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.7.html" ><span class="radius info label ">5.7</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.8.html" ><span class="radius info label ">5.8</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.9.html" ><span class="radius info label ">5.9</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.10.html" ><span class="radius info label ">5.10</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.11.html" ><span class="radius info label ">5.11</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.12.html" ><span class="radius info label ">5.12</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.13.html" ><span class="radius info label ">5.13</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.14.html" ><span class="radius info label ">5.14</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.15.html" ><span class="radius info label ">5.15</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.16.html" ><span class="radius info label ">5.16</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.17.html" ><span class="radius info label ">5.17</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.18.html" ><span class="radius info label ">5.18</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.19.html" ><span class="radius info label ">5.19</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.20.html" ><span class="radius info label ">5.20</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.21.html" ><span class="radius info label ">5.21</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.22.html" ><span class="radius info label ">5.22</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.23.html" ><span class="radius info label ">5.23</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.24.html" ><span class="radius info label ">5.24</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.25.html" ><span class="radius info label ">5.25</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.26.html" ><span class="radius info label ">5.26</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.27.html" ><span class="radius info label ">5.27</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.28.html" ><span class="radius info label ">5.28</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.29.html" ><span class="radius info label ">5.29</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.30.html" ><span class="radius info label todo">5.30</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.31.html" ><span class="radius info label ">5.31</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.32.html" ><span class="radius info label ">5.32</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.33.html" ><span class="radius info label ">5.33</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.34.html" ><span class="radius info label ">5.34</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.35.html" ><span class="radius info label ">5.35</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.36.html" ><span class="radius info label ">5.36</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.37.html" ><span class="radius info label ">5.37</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.38.html" ><span class="radius info label ">5.38</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.39.html" ><span class="radius info label ">5.39</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.40.html" ><span class="radius info label ">5.40</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.41.html" ><span class="radius info label ">5.41</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.42.html" ><span class="radius info label ">5.42</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.43.html" ><span class="radius info label ">5.43</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.44.html" ><span class="radius info label ">5.44</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.45.html" ><span class="radius info label ">5.45</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.46.html" ><span class="radius info label ">5.46</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.47.html" ><span class="radius info label ">5.47</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.48.html" ><span class="radius info label ">5.48</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.49.html" ><span class="radius info label ">5.49</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.50.html" ><span class="radius success label ">5.50</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.51.html" ><span class="radius info label todo">5.51</span></a>
							

                            
                            

                            

                            

                            
							    <a href="/sicp/ch-5/ex-5.52.html" ><span class="radius info label todo">5.52</span></a>
							

                            
                        </div>
                    </li>
                    
                </ul>

                <div class="show-for-small-down">
                    <hr class="t20"/>
                </div>

            </div>
        </div>
    </div><!-- /.medium-4.columns -->
    <div class="medium-9 columns medium-pull-3">
        <div class="row">
            <div class="medium-11 medium-offset-1 columns">
                <article itemscope itemtype="http://schema.org/Article">
                    <header>
                        <span itemprop="name">
                            
                            <h3>Chapter 5, Computing with Register Machines</h3>
                            
                            
								
								
								<h4>Exercise 5.50</h4>
								
							
                        </span>
                    </header>

                    
                    <p class="tm10">
                        <time class="post-date pr20" datetime="May 13, 2018" itemprop="datePublished"> May 13, 2018</time>
                    </p>
                    

                    <span itemprop="articleSection">
                        <hr/>
                        <p>Interesting!</p>

<p>The whole exercise is more about integration than coding. Setting up <code class="highlighter-rouge">apply</code> took most of the time.</p>

<p>Here’s how i setup the code:</p>

<h4 id="changes-in-chapter-4-evaluator">Changes in chapter-4 evaluator</h4>

<p>File names <code class="highlighter-rouge">ch4-mceval.scm</code> contained code for chapet-4 evaluator. I took this file from mit website thus it contains no changes/customisations done as part of exercises of ch-4.</p>

<p>I put the whole code in an expression like this:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="p">(</span><span class="k">define</span> <span class="nv">mceval-expression</span> <span class="o">'</span><span class="p">(</span><span class="k">begin</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;; all the code of ch4-mceval.scm</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;;;</span>
<span class="c1">;;(driver-loop)</span>
<span class="ss">'METACIRCULAR-EVALUATOR-LOADED</span>
<span class="p">))</span> <span class="c1">;;expression ends here</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Before going to other parts, let me first point out few changes i made in the above code:</p>

<ul>
  <li>intitialize the global environment.</li>
  <li>added few primitive procedures like <code class="highlighter-rouge">-</code>, <code class="highlighter-rouge">*</code> so that i can test <code class="highlighter-rouge">factorial</code> program :).</li>
</ul>

<p>Here are those changes:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="c1">;;this line is already in the code just need to uncomment it</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">the-global-environment</span> <span class="p">(</span><span class="nf">setup-environment</span><span class="p">))</span>


<span class="c1">;;added few primitive in this section marked by ;;;</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">primitive-procedures</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'car</span> <span class="nv">car</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'cdr</span> <span class="nv">cdr</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'cons</span> <span class="nv">cons</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'null?</span> <span class="nv">null?</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'+</span> <span class="nv">+</span><span class="p">)</span>     <span class="c1">;;;</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'-</span> <span class="nv">-</span><span class="p">)</span>     <span class="c1">;;;</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'*</span> <span class="nv">*</span><span class="p">)</span>     <span class="c1">;;;</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'=</span> <span class="nv">=</span><span class="p">)</span>     <span class="c1">;;;</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'not</span> <span class="nv">not</span><span class="p">)</span> <span class="c1">;;;</span>
<span class="c1">;;      more primitives</span>
        <span class="p">))</span></pre></td></tr></tbody></table></code></pre></figure>

<h4 id="changes-in-ch5-eceval-supportscm">Changes in ch5-eceval-support.scm</h4>

<p>Here, we just added few more primitive procedures:</p>

<p>Note: procedures installed here in the compiler are primitive procedures for evaluator. Thus we can install any procedure even which is not available in scheme and then later use it in our evaluator and even install there as a primitve procedure like we installed here scheme’s procedure as primitive procedures such that it can be used by the code written on top of evaluator!</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre><span class="c1">;;procedures added for ex-5.50</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'list</span> <span class="nv">list</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'length</span> <span class="nv">length</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cddr</span> <span class="nv">cddr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cadr</span> <span class="nv">cadr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cdar</span> <span class="nv">cdar</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cdddr</span> <span class="nv">cdddr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cdadr</span> <span class="nv">cdadr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cddar</span> <span class="nv">cddar</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'caddr</span> <span class="nv">caddr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'caadr</span> <span class="nv">caadr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cadddr</span> <span class="nv">cadddr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'set-car!</span> <span class="nv">set-car!</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'set-cdr!</span> <span class="nv">set-cdr!</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'newline</span> <span class="nv">newline</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'display</span> <span class="nv">display</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'error</span> <span class="nv">error</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'read</span> <span class="nv">read</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'eq?</span> <span class="nv">eq?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'number?</span> <span class="nv">number?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'symbol?</span> <span class="nv">symbol?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'pair?</span> <span class="nv">pair?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'string?</span> <span class="nv">string?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'not</span> <span class="nv">not</span><span class="p">)</span></pre></td></tr></tbody></table></code></pre></figure>

<hr />

<h4 id="setting-up-apply-and-map-procedures">setting up apply and map procedures</h4>

<p>This is where the it took me time figuring out.</p>

<p>Let’s first talk about <code class="highlighter-rouge">map</code>. In the chapter-4 mceval evaluator we use <code class="highlighter-rouge">map</code>. Since this evaluator compiles on our own compiler, we need to provide <code class="highlighter-rouge">map</code> from implicitly as part of the language or just build a <code class="highlighter-rouge">map</code> in the evaluator code itself.</p>

<p>How to give <code class="highlighter-rouge">map</code> as part of the language?</p>

<p>Can we give underlying scheme <code class="highlighter-rouge">map</code> as primitive procedure like we did above for <code class="highlighter-rouge">+</code>, <code class="highlighter-rouge">cons</code> etc?</p>

<p>No. Because <code class="highlighter-rouge">map</code> accepts <em>lambda</em> and in this context this lambda is not the underlying scheme lambda but our own compiled version of lambda! The underlying scheme is not aware of our compiled represention of lambda.</p>

<p>The solution is we simply write <code class="highlighter-rouge">map</code> as part of a libs and while compiling evaluator, we first <em>compile</em> all the library these procedures like <code class="highlighter-rouge">map</code> we want to give.</p>

<p>Similarly we need to do with <code class="highlighter-rouge">apply</code>. But there are few more nuances for <code class="highlighter-rouge">apply</code>. Let’s first see the code how to setup this:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="p">(</span><span class="k">define</span> <span class="nv">libs</span>
  <span class="o">'</span><span class="p">(</span><span class="k">begin</span>

	 <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nb">apply</span> <span class="nv">proc</span> <span class="nv">arguments</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">specialform-apply</span> <span class="nv">proc</span> <span class="nv">arguments</span><span class="p">))</span>
	 
	 <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">proc</span> <span class="nv">items</span><span class="p">)</span>
		  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">items</span><span class="p">)</span>
			  <span class="o">'</span><span class="p">()</span>
			  <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">items</span><span class="p">))</span>
					<span class="p">(</span><span class="nb">map</span> <span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">items</span><span class="p">)))))</span>
	 <span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">libs-and-mceval</span>
  <span class="o">`</span><span class="p">(</span><span class="k">begin</span> <span class="o">,</span><span class="nv">libs</span> <span class="o">,</span><span class="nv">mceval-expression</span><span class="p">))</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Note, that <code class="highlighter-rouge">mceval-expression</code> contains the code of our evaluator.</p>

<p>Thus, now <code class="highlighter-rouge">libs-and-mceval</code> contains all the code that needs to be compiled.</p>

<p>Okay, Before we put everything together, let’s first understand <code class="highlighter-rouge">apply</code>:</p>

<p>Recall that we need to give <code class="highlighter-rouge">apply</code> from the <em>compiler</em> to the <em>evaluator</em>.</p>

<p>Note that evaluator uses <code class="highlighter-rouge">apply</code> only for primtive procedures thus we can get away by writing <code class="highlighter-rouge">apply</code> which internally calls schemes underlying <code class="highlighter-rouge">apply</code>.</p>

<p>But, it won’t be a complete implementation of <code class="highlighter-rouge">apply</code> because it won’t work for compiled procedures!</p>

<p>Another approach is we give a special form <code class="highlighter-rouge">apply</code> which can understand compiled procedures!</p>

<p>But the special form <code class="highlighter-rouge">apply</code> won’t be a procedure like <code class="highlighter-rouge">map</code>. See how the evaluator use <code class="highlighter-rouge">apply</code>:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="p">(</span><span class="k">define</span> <span class="nv">apply-in-underlying-scheme</span> <span class="nv">apply</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">apply-primitive-procedure</span> <span class="nv">proc</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-in-underlying-scheme</span>
   <span class="p">(</span><span class="nf">primitive-implementation</span> <span class="nv">proc</span><span class="p">)</span> <span class="nv">args</span><span class="p">))</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The first line won’t work if <code class="highlighter-rouge">apply</code> is a special form!</p>

<p>So, we build a special form <code class="highlighter-rouge">specialform-apply</code> and also build a procedure <code class="highlighter-rouge">apply</code> and our procedure <code class="highlighter-rouge">apply</code> internally uses <code class="highlighter-rouge">specialform-apply</code>. As show in the above code of <code class="highlighter-rouge">libs</code>.</p>

<p>Here’s the code of <code class="highlighter-rouge">specialform-apply</code> in the compiler(file ch5-compiler.scm):</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="c1">;;add following in the main procedure compile</span>
<span class="p">((</span><span class="nf">specialform-apply?</span> <span class="nv">exp</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">compile-specialform-apply</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>


<span class="c1">;;new procedure</span>
<span class="c1">;;the code is similar to compile-application except:</span>
<span class="c1">;;- change in accessors to get the procedure and arguments.</span>
<span class="c1">;;- there is only one argument which should be a list because apply takes list of arguments as a list.</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-specialform-apply</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">proc-code</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">specialform-apply-procedure</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'proc</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">args-code</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">specialform-apply-arguments</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'argl</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">continue</span><span class="p">)</span>
     <span class="nv">proc-code</span>
     <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span> <span class="nv">continue</span><span class="p">)</span>
				 <span class="nv">args-code</span>
				 <span class="p">(</span><span class="nf">compile-procedure-call</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">)))))</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Ofcourse, there are few procedures for this new syntax added(i added them in file ch5-syntax.scm):</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">specialform-apply?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'specialform-apply</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">specialform-apply-procedure</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">specialform-apply-arguments</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr</span> <span class="nv">exp</span><span class="p">))</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Let’s put this all together:</p>

<h4 id="putting-it-all-together">Putting it all together</h4>

<p>Now, the main part how to put all components together and compile and execute.</p>

<p>I used the code built in previous exercise, ch5-compiler-machine.scm and added few changes in the compiler machine so that on start it will first parse the evaluator.</p>

<p>Here is the updated code, after changes in the solution of previous exercise:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
</pre></td><td class="code"><pre><span class="p">(</span><span class="nb">load</span> <span class="s">"ch5-compiler"</span><span class="p">)</span>

<span class="p">(</span><span class="nb">load</span> <span class="s">"ch5-regsim"</span><span class="p">)</span>

<span class="p">(</span><span class="nb">load</span> <span class="s">"ch5-eceval-support"</span><span class="p">)</span>

<span class="p">(</span><span class="nb">load</span> <span class="s">"ch4-mceval"</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">the-global-environment</span> <span class="p">(</span><span class="nf">setup-environment</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">prompt-for-input</span> <span class="nv">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">display</span> <span class="nv">string</span><span class="p">)</span> <span class="p">(</span><span class="nb">newline</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">announce-output</span> <span class="nv">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">display</span> <span class="nv">string</span><span class="p">)</span> <span class="p">(</span><span class="nb">newline</span><span class="p">))</span>

<span class="c1">;; Modification of section 4.1.4 procedure</span>
<span class="c1">;; **replaces version in syntax file</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">user-print</span> <span class="nv">object</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nf">compound-procedure?</span> <span class="nv">object</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'compound-procedure</span>
                        <span class="p">(</span><span class="nf">procedure-parameters</span> <span class="nv">object</span><span class="p">)</span>
                        <span class="p">(</span><span class="nf">procedure-body</span> <span class="nv">object</span><span class="p">)</span>
                        <span class="ss">'&lt;procedure-env&gt;</span><span class="p">)))</span>
        <span class="p">((</span><span class="nf">compiled-procedure?</span> <span class="nv">object</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">display</span> <span class="ss">'&lt;compiled-procedure&gt;</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nb">display</span> <span class="nv">object</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-and-assemble</span> <span class="nv">expression</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">assemble</span> <span class="p">(</span><span class="nf">statements</span>
             <span class="p">(</span><span class="nf">compile</span> <span class="nv">expression</span> <span class="ss">'val</span> <span class="ss">'return</span> <span class="nv">the-empty-cenv</span><span class="p">))</span>
            <span class="nv">compiler-machine</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">compiler-operations</span>
  <span class="p">(</span><span class="nb">list</span> 
   <span class="c1">;;primitive Scheme operations</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'read</span> <span class="nv">read</span><span class="p">)</span>			

   <span class="p">(</span><span class="nb">list</span> <span class="ss">'list</span> <span class="nv">list</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'cons</span> <span class="nv">cons</span><span class="p">)</span>

   <span class="p">(</span><span class="nb">list</span> <span class="ss">'compile-and-assemble</span> <span class="nv">compile-and-assemble</span><span class="p">)</span>
   
   <span class="c1">;;operations in eceval-support.scm</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'false?</span> <span class="nv">false?</span><span class="p">)</span> 
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'extend-environment</span> <span class="nv">extend-environment</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'lookup-variable-value</span> <span class="nv">lookup-variable-value</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'set-variable-value!</span> <span class="nv">set-variable-value!</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'define-variable!</span> <span class="nv">define-variable!</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'primitive-procedure?</span> <span class="nv">primitive-procedure?</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'apply-primitive-procedure</span> <span class="nv">apply-primitive-procedure</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'prompt-for-input</span> <span class="nv">prompt-for-input</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'announce-output</span> <span class="nv">announce-output</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'user-print</span> <span class="nv">user-print</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'get-global-environment</span> <span class="nv">get-global-environment</span><span class="p">)</span>

   <span class="c1">;;for compiled code (also in eceval-support.scm)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'make-compiled-procedure</span> <span class="nv">make-compiled-procedure</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'compiled-procedure?</span> <span class="nv">compiled-procedure?</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'compiled-procedure-entry</span> <span class="nv">compiled-procedure-entry</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'compiled-procedure-env</span> <span class="nv">compiled-procedure-env</span><span class="p">)</span>

   <span class="c1">;;for open-code ex-5.38</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'lexical-address-lookup</span> <span class="nv">lexical-address-lookup</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'lexical-address-set!</span> <span class="nv">lexical-address-set!</span><span class="p">)</span>
   <span class="c1">;;added few operations for testing ex-5.38 as machine intructions</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'+</span> <span class="nv">+</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'=</span> <span class="nv">=</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'-</span> <span class="nv">-</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'*</span> <span class="nv">*</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'&lt;</span> <span class="nv">&lt;</span><span class="p">)))</span>

<span class="c1">;;define map here for ex-5.50 bec it is used in this</span>
<span class="c1">;;and we can not use primitive map bec. primtive map</span>
<span class="c1">;;will expect the lambda passed to it to be primitive too.  </span>
<span class="c1">;;but here the lambda passed would be our compiled lambda</span>

<span class="c1">;;as part of ex-5.50, the evaluator needs apply</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">libs</span>
  <span class="o">'</span><span class="p">(</span><span class="k">begin</span>

	 <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nb">apply</span> <span class="nv">proc</span> <span class="nv">arguments</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">specialform-apply</span> <span class="nv">proc</span> <span class="nv">arguments</span><span class="p">))</span>

	 <span class="ss">'apply-done</span>
	 
	 <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">proc</span> <span class="nv">items</span><span class="p">)</span>
		  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">items</span><span class="p">)</span>
			  <span class="o">'</span><span class="p">()</span>
			  <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">items</span><span class="p">))</span>
					<span class="p">(</span><span class="nb">map</span> <span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">items</span><span class="p">)))))</span>
	 <span class="ss">'map-done</span>

	 <span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">libs-and-mceval</span>
  <span class="o">`</span><span class="p">(</span><span class="k">begin</span> <span class="o">,</span><span class="nv">libs</span> <span class="o">,</span><span class="nv">mceval-expression</span><span class="p">))</span>

<span class="c1">;(define the-compiled-machine (compile-and-assemble libs-and-mceval))</span>

<span class="p">(</span><span class="nb">display</span> <span class="ss">'done</span><span class="p">)</span>
<span class="c1">;(display libs-and-mceval)</span>
	
<span class="p">(</span><span class="k">define</span> <span class="nv">compiler-machine</span>
  <span class="p">(</span><span class="nf">make-machine</span>
   <span class="o">'</span><span class="p">(</span><span class="nb">exp</span> <span class="nv">env</span> <span class="nv">val</span> <span class="nv">proc</span> <span class="nv">argl</span> <span class="nv">continue</span> <span class="nv">unev</span>
	 <span class="nv">arg1</span> <span class="nv">arg2</span>
	 <span class="p">)</span>
   <span class="nv">compiler-operations</span>
   <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">exp</span> <span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="nv">libs-and-mceval</span><span class="p">))</span>  <span class="c1">;;note that here we put the complete code in exp</span>
	 <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">label</span> <span class="nv">compile-n-assemble</span><span class="p">))</span>
	 <span class="nv">read-compile-execute-print-loop</span>
	 <span class="p">(</span><span class="nf">perform</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">initialize-stack</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">perform</span>
	  <span class="p">(</span><span class="nf">op</span> <span class="nv">prompt-for-input</span><span class="p">)</span> <span class="p">(</span><span class="nf">const</span> <span class="s">";;; RCEPL input:"</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">assign</span> <span class="nv">exp</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">read</span><span class="p">))</span>
	 <span class="nv">compile-n-assemble</span>
	 <span class="p">(</span><span class="nf">assign</span> <span class="nv">val</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">compile-and-assemble</span><span class="p">)</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">exp</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">perform</span>
	  <span class="p">(</span><span class="nf">op</span> <span class="nv">announce-output</span><span class="p">)</span> <span class="p">(</span><span class="nf">const</span> <span class="ss">'compiled-and-assembled</span><span class="p">))</span>  <span class="c1">;;i just added this print to ensure things have compiled</span>
	 <span class="p">(</span><span class="nf">assign</span> <span class="nv">env</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">get-global-environment</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">assign</span> <span class="nv">continue</span> <span class="p">(</span><span class="nf">label</span> <span class="nv">print-result</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">))</span>
	 <span class="nv">print-result</span>
	 <span class="c1">;;**following instruction optional -- if use it, need monitored stack</span>
	 <span class="p">(</span><span class="nf">perform</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">print-stack-statistics</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">perform</span>
	  <span class="p">(</span><span class="nf">op</span> <span class="nv">announce-output</span><span class="p">)</span> <span class="p">(</span><span class="nf">const</span> <span class="s">";;; RECEPL value:"</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">perform</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">user-print</span><span class="p">)</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">label</span> <span class="nv">read-compile-execute-print-loop</span><span class="p">)))))</span>

<span class="c1">;;these are commands which can reset the scheme environment(mit-scheme only).</span>
<span class="c1">;;they should be used only when one want to forget all the previous variables in repl scheme.</span>
<span class="c1">;; (ge (make-top-level-environment))</span>
<span class="c1">;; (restart 1)</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Note that the except for register simulator, file <code class="highlighter-rouge">ch5-regsim.scm</code> and chapter 4 evaluator <code class="highlighter-rouge">ch4-mceval.scm</code>(except the changes mentioned above) are the original files from the mit website without any changes.</p>

<p>The file <code class="highlighter-rouge">ch5-compiler</code>, <code class="highlighter-rouge">ch5-syntax.scm</code> and <code class="highlighter-rouge">ch5-eceval-support</code> contains changes as were done in earlier exercises including the changes mentioned in this exercise.</p>

<p>(i shall put the complete code of these files at the bottom of this page)</p>

<p>This file contains everything we need!</p>

<p>Let’s just load this file:</p>

<h4 id="testingexamples">Testing/Examples</h4>

<p>Note the call to <code class="highlighter-rouge">(driver-loop)</code> to start the evaluator inside the compiler’s read-compile-execute-print loop.</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="code"><pre><span class="mi">1</span> <span class="p">]</span><span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">start</span> <span class="nv">compiler-machine</span><span class="p">)</span>

<span class="p">(</span><span class="k">quote</span> <span class="nv">compiled-and-assembled</span><span class="p">)</span>

<span class="p">(</span><span class="nf">total-pushes</span> <span class="nv">=</span> <span class="mi">449</span> <span class="nv">maximum-depth</span> <span class="nv">=</span> <span class="mi">36</span><span class="p">)</span>
<span class="c1">;;; RECEPL value:</span>
<span class="nv">metacircular-evaluator-loaded</span>

<span class="c1">;;; RCEPL input:</span>
<span class="p">(</span><span class="nf">driver-loop</span><span class="p">)</span>

<span class="p">(</span><span class="k">quote</span> <span class="nv">compiled-and-assembled</span><span class="p">)</span>


<span class="c1">;;; M-Eval input:</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">factorial</span> <span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
        <span class="mi">1</span>
        <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nf">factorial</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">n</span><span class="p">)))</span>

<span class="c1">;;; M-Eval value:</span>
<span class="nv">ok</span>

<span class="c1">;;; M-Eval input:</span>
<span class="p">(</span><span class="nf">factorial</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1">;;; M-Eval value:</span>
<span class="mi">120</span>

<span class="c1">;;; M-Eval input:</span>
<span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">((</span><span class="k">lambda</span><span class="p">()</span> <span class="mi">3</span><span class="p">)))</span>

<span class="c1">;;; M-Eval value:</span>
<span class="mi">6</span>

<span class="c1">;;; M-Eval input:</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">100</span> <span class="p">(</span><span class="nf">factorial</span> <span class="mi">10</span><span class="p">)))</span>

<span class="c1">;;; M-Eval value:</span>
<span class="nv">ok</span>

<span class="c1">;;; M-Eval input:</span>
<span class="nv">x</span>

<span class="c1">;;; M-Eval value:</span>
<span class="mi">3628900</span>

<span class="c1">;;; M-Eval input:</span></pre></td></tr></tbody></table></code></pre></figure>

<p>That’s it!</p>

<hr />

<hr />

<h4 id="complete-code">Complete code</h4>

<p>Code in for compiler, file: ch5-compiler</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
</pre></td><td class="code"><pre><span class="c1">;;;;COMPILER FROM SECTION 5.5 OF</span>
<span class="c1">;;;; STRUCTURE AND INTERPRETATION OF COMPUTER PROGRAMS</span>

<span class="c1">;;;;Matches code in ch5.scm</span>

<span class="c1">;;;;This file can be loaded into Scheme as a whole.</span>
<span class="c1">;;;;**NOTE**This file loads the metacircular evaluator's syntax procedures</span>
<span class="c1">;;;;  from section 4.1.2</span>
<span class="c1">;;;;  You may need to change the (load ...) expression to work in your</span>
<span class="c1">;;;;  version of Scheme.</span>

<span class="c1">;;;;Then you can compile Scheme programs as shown in section 5.5.5</span>

<span class="c1">;;**implementation-dependent loading of syntax procedures</span>
<span class="p">(</span><span class="nb">load</span> <span class="s">"ch5-syntax.scm"</span><span class="p">)</span>			<span class="c1">;section 4.1.2 syntax procedures</span>


<span class="c1">;;;SECTION 5.5.1</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nf">self-evaluating?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">compile-self-evaluating</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">quoted?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile-quoted</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">variable?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">compile-variable</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">assignment?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">compile-assignment</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">definition?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">compile-definition</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">if?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile-if</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">lambda?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile-lambda</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">let?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">let-&gt;combination</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">begin?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">compile-sequence</span> <span class="p">(</span><span class="nf">begin-actions</span> <span class="nv">exp</span><span class="p">)</span>
                           <span class="nv">target</span>
                           <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">cond?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">cond-&gt;if</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
		<span class="p">((</span><span class="nf">same?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile-same</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
		<span class="p">((</span><span class="nf">less?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile-less</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
		<span class="p">((</span><span class="nf">add?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile-add</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
		<span class="p">((</span><span class="nf">sub?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile-sub</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
		<span class="p">((</span><span class="nf">mul?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile-mul</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
		<span class="p">((</span><span class="nf">specialform-apply?</span> <span class="nv">exp</span><span class="p">)</span>
		 <span class="p">(</span><span class="nf">compile-specialform-apply</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">application?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">compile-application</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else</span>
         <span class="p">(</span><span class="nf">error</span> <span class="s">"Unknown expression type -- COMPILE"</span> <span class="nv">exp</span><span class="p">))))</span>


<span class="p">(</span><span class="k">define</span> <span class="nv">all-arg-regs</span> <span class="o">'</span><span class="p">(</span><span class="nf">arg1</span> <span class="nv">arg2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">total-arg-regs</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">all-arg-regs</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">spread-arguments</span> <span class="nv">operands-list</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">iter</span> <span class="nv">operands-list</span> <span class="nv">arg-regs</span><span class="p">)</span>
	<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">operands-list</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">empty-instruction-sequence</span><span class="p">)</span>
		<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">rest-seq</span> <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">operands-list</span><span class="p">)</span>
							  <span class="p">(</span><span class="nb">cdr</span> <span class="nv">arg-regs</span><span class="p">)))</span>
			  <span class="p">(</span><span class="nf">first-seq</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">operands-list</span><span class="p">)</span>
								  <span class="p">(</span><span class="nb">car</span> <span class="nv">arg-regs</span><span class="p">)</span>
								  <span class="ss">'next</span>
								  <span class="nv">cenv</span><span class="p">)))</span>
		  <span class="p">(</span><span class="nf">preserving</span>
		   <span class="o">'</span><span class="p">(</span><span class="nf">env</span><span class="p">)</span>
		   <span class="nv">rest-seq</span>
		   <span class="p">(</span><span class="nf">preserving</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">arg-regs</span><span class="p">)</span>
					   <span class="nv">first-seq</span>
					   <span class="p">(</span><span class="nf">make-instruction-sequence</span>
						<span class="p">(</span><span class="nb">cdr</span> <span class="nv">arg-regs</span><span class="p">)</span>
						<span class="o">'</span><span class="p">()</span>
						<span class="o">'</span><span class="p">()))))))</span>
  <span class="p">(</span><span class="nf">iter</span> <span class="nv">operands-list</span> <span class="p">(</span><span class="nf">take</span> <span class="nv">all-arg-regs</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">operands-list</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">same?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'=</span><span class="p">)</span>
							  <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'not-found</span> <span class="p">(</span><span class="nf">find-variable</span> <span class="ss">'=</span> <span class="nv">cenv</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">mul?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'*</span><span class="p">)</span>
							 <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'not-found</span> <span class="p">(</span><span class="nf">find-variable</span> <span class="ss">'*</span> <span class="nv">cenv</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">sub?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'-</span><span class="p">)</span>
							 <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'not-found</span> <span class="p">(</span><span class="nf">find-variable</span> <span class="ss">'-</span> <span class="nv">cenv</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">add?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'+</span><span class="p">)</span>
							 <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'not-found</span> <span class="p">(</span><span class="nf">find-variable</span> <span class="ss">'+</span> <span class="nv">cenv</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">less?</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'&lt;</span><span class="p">)</span>
							  <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'not-found</span> <span class="p">(</span><span class="nf">find-variable</span> <span class="ss">'&lt;</span> <span class="nv">cenv</span><span class="p">))))</span>

<span class="c1">;;it return list like '((reg arg1) (reg arg2) ... )</span>
<span class="c1">;;for each reg in arg-regs passed</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-arg-regs-list</span> <span class="nv">arg-regs</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span><span class="p">(</span><span class="nf">reg</span><span class="p">)</span>
		 <span class="p">(</span><span class="nb">list</span> <span class="ss">'reg</span> <span class="nv">reg</span><span class="p">))</span>
	   <span class="nv">arg-regs</span><span class="p">))</span>
  
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-open-code</span> <span class="nv">operation</span> <span class="nv">operands-list</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">operands-length</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">operands-list</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">operands-length</span> <span class="nv">total-arg-regs</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">error</span> <span class="s">"Open code primitive operands are more than the available arg regs."</span><span class="p">)</span>
		<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">arg-regs</span> <span class="p">(</span><span class="nf">take</span> <span class="nv">all-arg-regs</span> <span class="nv">operands-length</span><span class="p">)))</span>
		  <span class="p">(</span><span class="nf">end-with-linkage</span>
		   <span class="nv">linkage</span>
		   <span class="p">(</span><span class="nf">append-instruction-sequences</span>
			<span class="p">(</span><span class="nf">spread-arguments</span> <span class="nv">operands-list</span> <span class="nv">cenv</span><span class="p">)</span>
			<span class="p">(</span><span class="nf">make-instruction-sequence</span>
			 <span class="nv">arg-regs</span>
			 <span class="o">`</span><span class="p">(</span><span class="nf">,target</span><span class="p">)</span>
			 <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span>
					   <span class="p">(</span><span class="nf">op</span> <span class="o">,</span><span class="nv">operation</span><span class="p">)</span>
					   <span class="o">.</span> <span class="c1">;;notice the dot</span>
					   <span class="o">,</span><span class="p">(</span><span class="nf">make-arg-regs-list</span> <span class="nv">arg-regs</span><span class="p">))))))))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">split</span> <span class="nv">items</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">=</span> <span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="o">'</span><span class="p">()</span> <span class="nv">items</span><span class="p">))</span>
		<span class="p">((</span><span class="nb">null?</span> <span class="nv">items</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">()))</span>
		<span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">n-1-split</span> <span class="p">(</span><span class="nf">split</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">items</span><span class="p">)</span>
									  <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
				<span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">items</span><span class="p">)</span>
							<span class="p">(</span><span class="nb">car</span> <span class="nv">n-1-split</span><span class="p">))</span>
					  <span class="p">(</span><span class="nb">cdr</span> <span class="nv">n-1-split</span><span class="p">))))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">split-and-compile</span> <span class="nv">operator</span> <span class="nv">operands</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">splitted</span> <span class="p">(</span><span class="nf">split</span> <span class="nv">operands</span> <span class="nv">total-arg-regs</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">first-part</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">splitted</span><span class="p">))</span>
		  <span class="p">(</span><span class="nf">rem-part</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">splitted</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">rem-part</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">compile-open-code</span> <span class="nv">operator</span> <span class="nv">first-part</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
		  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">new-operand-1</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">operator</span> <span class="nv">first-part</span><span class="p">))</span>
				<span class="p">(</span><span class="nf">new-operand-2</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">rem-part</span><span class="p">))</span>
								   <span class="p">(</span><span class="nb">car</span> <span class="nv">rem-part</span><span class="p">)</span>
								   <span class="p">(</span><span class="nb">cons</span> <span class="nv">operator</span> <span class="nv">rem-part</span><span class="p">))))</span>
			<span class="p">(</span><span class="nf">compile-open-code</span> <span class="nv">operator</span>
							   <span class="p">(</span><span class="nb">list</span> <span class="nv">new-operand-1</span> <span class="nv">new-operand-2</span><span class="p">)</span>
							   <span class="nv">target</span>
							   <span class="nv">linkage</span>
							   <span class="nv">cenv</span><span class="p">))))))</span>
	
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-add</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">split-and-compile</span> <span class="ss">'+</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-same</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">compile-open-code</span> <span class="ss">'=</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-less</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">compile-open-code</span> <span class="ss">'&lt;</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-mul</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">split-and-compile</span> <span class="ss">'*</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-sub</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">compile-open-code</span> <span class="ss">'-</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="nv">needs</span> <span class="nv">modifies</span> <span class="nv">statements</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nv">needs</span> <span class="nv">modifies</span> <span class="nv">statements</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">empty-instruction-sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">()))</span>


<span class="c1">;;;SECTION 5.5.2</span>

<span class="c1">;;;linkage code</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-linkage</span> <span class="nv">linkage</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">continue</span><span class="p">)</span> <span class="o">'</span><span class="p">()</span>
          <span class="o">'</span><span class="p">((</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">continue</span><span class="p">)))))</span>
        <span class="p">((</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'next</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">empty-instruction-sequence</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else</span>
         <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">()</span>
          <span class="o">`</span><span class="p">((</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">linkage</span><span class="p">)))))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">end-with-linkage</span> <span class="nv">linkage</span> <span class="nv">instruction-sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">continue</span><span class="p">)</span>
   <span class="nv">instruction-sequence</span>
   <span class="p">(</span><span class="nf">compile-linkage</span> <span class="nv">linkage</span><span class="p">)))</span>


<span class="c1">;;;simple expressions</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-self-evaluating</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">end-with-linkage</span> <span class="nv">linkage</span>
   <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">target</span><span class="p">)</span>
    <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span> <span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="nv">exp</span><span class="p">))))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-quoted</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">end-with-linkage</span> <span class="nv">linkage</span>
   <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">target</span><span class="p">)</span>
    <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span> <span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="p">(</span><span class="nf">text-of-quotation</span> <span class="nv">exp</span><span class="p">)))))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-variable</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">lex-addr</span> <span class="p">(</span><span class="nf">find-variable</span> <span class="nv">exp</span> <span class="nv">cenv</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">end-with-linkage</span> <span class="nv">linkage</span>
					  <span class="p">(</span><span class="nf">make-instruction-sequence</span>
					   <span class="o">'</span><span class="p">(</span><span class="nf">env</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">target</span><span class="p">)</span>
					   <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">lex-addr</span> <span class="ss">'not-found</span><span class="p">)</span>
						   <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span>
									 <span class="p">(</span><span class="nf">op</span> <span class="nv">lookup-variable-value</span><span class="p">)</span>
									 <span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="nv">exp</span><span class="p">)</span>
									 <span class="p">(</span><span class="nf">reg</span> <span class="nv">env</span><span class="p">)))</span>
						   <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span>
									 <span class="p">(</span><span class="nf">op</span> <span class="nv">lexical-address-lookup</span><span class="p">)</span>
									 <span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="nv">lex-addr</span><span class="p">)</span>
									 <span class="p">(</span><span class="nf">reg</span> <span class="nv">env</span><span class="p">))))))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-assignment</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">var</span> <span class="p">(</span><span class="nf">assignment-variable</span> <span class="nv">exp</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">get-value-code</span>
         <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">assignment-value</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'val</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">lex-addr</span> <span class="p">(</span><span class="nf">find-variable</span> <span class="nv">var</span> <span class="nv">cenv</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">end-with-linkage</span>
	   <span class="nv">linkage</span>
	   <span class="p">(</span><span class="nf">preserving</span>
		<span class="o">'</span><span class="p">(</span><span class="nf">env</span><span class="p">)</span>
		<span class="nv">get-value-code</span>
		<span class="p">(</span><span class="nf">make-instruction-sequence</span>
		 <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">val</span><span class="p">)</span>
		 <span class="p">(</span><span class="nb">list</span> <span class="nv">target</span><span class="p">)</span>
		 <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">lex-addr</span> <span class="ss">'not-found</span><span class="p">)</span>
			 <span class="o">`</span><span class="p">((</span><span class="nf">perform</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">set-variable-value!</span><span class="p">)</span>
						<span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="nv">var</span><span class="p">)</span>
						<span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">)</span>
						<span class="p">(</span><span class="nf">reg</span> <span class="nv">env</span><span class="p">))</span>
			   <span class="p">(</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span> <span class="p">(</span><span class="nf">const</span> <span class="nv">ok</span><span class="p">)))</span>
			 <span class="o">`</span><span class="p">((</span><span class="nf">perform</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">lexical-address-set!</span><span class="p">)</span>
						<span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="nv">lex-addr</span><span class="p">)</span>
						<span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">)</span>
						<span class="p">(</span><span class="nf">reg</span> <span class="nv">env</span><span class="p">))</span>
			   <span class="p">(</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span> <span class="p">(</span><span class="nf">const</span> <span class="nv">ok</span><span class="p">))))))))))</span>
	
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-definition</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">var</span> <span class="p">(</span><span class="nf">definition-variable</span> <span class="nv">exp</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">get-value-code</span>
         <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">definition-value</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'val</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">end-with-linkage</span> <span class="nv">linkage</span>
     <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span><span class="p">)</span>
      <span class="nv">get-value-code</span>
      <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">val</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">target</span><span class="p">)</span>
       <span class="o">`</span><span class="p">((</span><span class="nf">perform</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">define-variable!</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="nv">var</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">reg</span> <span class="nv">env</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span> <span class="p">(</span><span class="nf">const</span> <span class="nv">ok</span><span class="p">))))))))</span>


<span class="c1">;;;conditional expressions</span>

<span class="c1">;;;labels (from footnote)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">label-counter</span> <span class="mi">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">new-label-number</span><span class="p">)</span>
  <span class="p">(</span><span class="k">set!</span> <span class="nv">label-counter</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="nv">label-counter</span><span class="p">))</span>
  <span class="nv">label-counter</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-label</span> <span class="nv">name</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">string-&gt;symbol</span>
    <span class="p">(</span><span class="nb">string-append</span> <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="nv">name</span><span class="p">)</span>
                   <span class="p">(</span><span class="nb">number-&gt;string</span> <span class="p">(</span><span class="nf">new-label-number</span><span class="p">)))))</span>
<span class="c1">;; end of footnote</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-if</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">t-branch</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'true-branch</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">f-branch</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'false-branch</span><span class="p">))</span>                    
        <span class="p">(</span><span class="nf">after-if</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'after-if</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">consequent-linkage</span>
           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'next</span><span class="p">)</span> <span class="nv">after-if</span> <span class="nv">linkage</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">p-code</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">if-predicate</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'val</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">c-code</span>
             <span class="p">(</span><span class="nf">compile</span>
              <span class="p">(</span><span class="nf">if-consequent</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">consequent-linkage</span> <span class="nv">cenv</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">a-code</span>
             <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">if-alternative</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">continue</span><span class="p">)</span>
         <span class="nv">p-code</span>
         <span class="p">(</span><span class="nf">append-instruction-sequences</span>
          <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">val</span><span class="p">)</span> <span class="o">'</span><span class="p">()</span>
           <span class="o">`</span><span class="p">((</span><span class="nf">test</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">false?</span><span class="p">)</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">))</span>
             <span class="p">(</span><span class="nf">branch</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">f-branch</span><span class="p">))))</span>
          <span class="p">(</span><span class="nf">parallel-instruction-sequences</span>
           <span class="p">(</span><span class="nf">append-instruction-sequences</span> <span class="nv">t-branch</span> <span class="nv">c-code</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">append-instruction-sequences</span> <span class="nv">f-branch</span> <span class="nv">a-code</span><span class="p">))</span>
          <span class="nv">after-if</span><span class="p">))))))</span>

<span class="c1">;;; sequences</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-sequence</span> <span class="nv">seq</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">last-exp?</span> <span class="nv">seq</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">first-exp</span> <span class="nv">seq</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">continue</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">first-exp</span> <span class="nv">seq</span><span class="p">)</span> <span class="nv">target</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">compile-sequence</span> <span class="p">(</span><span class="nf">rest-exps</span> <span class="nv">seq</span><span class="p">)</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">))))</span>

<span class="c1">;;;lambda expressions</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-lambda</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">proc-entry</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'entry</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">after-lambda</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'after-lambda</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">lambda-linkage</span>
           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'next</span><span class="p">)</span> <span class="nv">after-lambda</span> <span class="nv">linkage</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">append-instruction-sequences</span>
       <span class="p">(</span><span class="nf">tack-on-instruction-sequence</span>
        <span class="p">(</span><span class="nf">end-with-linkage</span> <span class="nv">lambda-linkage</span>
         <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">target</span><span class="p">)</span>
          <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span>
                    <span class="p">(</span><span class="nf">op</span> <span class="nv">make-compiled-procedure</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">proc-entry</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">reg</span> <span class="nv">env</span><span class="p">)))))</span>
        <span class="p">(</span><span class="nf">compile-lambda-body</span> <span class="nv">exp</span> <span class="nv">proc-entry</span> <span class="nv">cenv</span><span class="p">))</span>
       <span class="nv">after-lambda</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-lambda-body</span> <span class="nv">exp</span> <span class="nv">proc-entry</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">formals</span> <span class="p">(</span><span class="nf">lambda-parameters</span> <span class="nv">exp</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">append-instruction-sequences</span>
     <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">proc</span> <span class="nv">argl</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span><span class="p">)</span>
      <span class="o">`</span><span class="p">(</span><span class="nf">,proc-entry</span>
        <span class="p">(</span><span class="nf">assign</span> <span class="nv">env</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">compiled-procedure-env</span><span class="p">)</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">proc</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">assign</span> <span class="nv">env</span>
                <span class="p">(</span><span class="nf">op</span> <span class="nv">extend-environment</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">const</span> <span class="o">,</span><span class="nv">formals</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">reg</span> <span class="nv">argl</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">reg</span> <span class="nv">env</span><span class="p">))))</span>
     <span class="p">(</span><span class="nf">compile-sequence</span> <span class="p">(</span><span class="nf">scan-out-defines</span>
						<span class="p">(</span><span class="nf">lambda-body</span> <span class="nv">exp</span><span class="p">))</span>
					   <span class="ss">'val</span>
					   <span class="ss">'return</span>
					   <span class="p">(</span><span class="nf">extend-cenv</span> <span class="nv">formals</span> <span class="nv">cenv</span><span class="p">)))))</span>

<span class="c1">;;this procedure copied from ex-4.16 for ex-5.43</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">scan-out-defines</span> <span class="nv">proc-body</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">result</span>
		 <span class="p">(</span><span class="nf">fold-right</span>
		  <span class="p">(</span><span class="k">lambda</span><span class="p">(</span><span class="nf">new</span> <span class="nv">rem</span><span class="p">)</span>
			<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">definition?</span> <span class="nv">new</span><span class="p">)</span>
				<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">var-def</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">definition-variable</span> <span class="nv">new</span><span class="p">)</span> <span class="o">'</span><span class="ss">'*unassigned*</span><span class="p">))</span>
					  <span class="p">(</span><span class="nf">var-set</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'set!</span> <span class="p">(</span><span class="nf">definition-variable</span> <span class="nv">new</span><span class="p">)</span> <span class="p">(</span><span class="nf">definition-value</span> <span class="nv">new</span><span class="p">))))</span>
					<span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">var-def</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">rem</span><span class="p">))</span>
						  <span class="p">(</span><span class="nb">cons</span> <span class="nv">var-set</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">rem</span><span class="p">))))</span>
				<span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">rem</span><span class="p">)</span>
					  <span class="p">(</span><span class="nb">cons</span> <span class="nv">new</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">rem</span><span class="p">)))))</span>
		  <span class="p">(</span><span class="nb">list</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">())</span>
		  <span class="nv">proc-body</span><span class="p">)))</span>
	
	  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">result</span><span class="p">))</span>
		  <span class="nv">proc-body</span> <span class="c1">;;return original else infinite loop!</span>
		  <span class="c1">;;note that this procedure was copied from ex-4.16</span>
		  <span class="c1">;;and there we put the result in a list</span>
		  <span class="c1">;;and it turns out we need to get the result</span>
		  <span class="c1">;;in a list here too bec this result is passed to</span>
		  <span class="c1">;;compiler sequence and it expects a sequence</span>
		  <span class="c1">;;which means a list!</span>
		  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">make-let</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">result</span><span class="p">)</span>
						  <span class="p">(</span><span class="nb">cadr</span> <span class="nv">result</span><span class="p">))))))</span>

<span class="c1">;;ex-5.40, 5.41</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">the-empty-cenv</span> <span class="o">'</span><span class="p">())</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">extend-cenv</span> <span class="nv">frame</span> <span class="nv">base-cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="nv">frame</span> <span class="nv">base-cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-lexical-address</span> <span class="nv">frame-num</span> <span class="nv">elem-num</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nv">frame-num</span> <span class="nv">elem-num</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lex-addr-frame-num</span> <span class="nv">lexical-address</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car</span> <span class="nv">lexical-address</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lex-addr-displacement</span> <span class="nv">lexical-address</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cadr</span> <span class="nv">lexical-address</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">the-empty-cenv</span> <span class="o">'</span><span class="p">())</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">extend-cenv</span> <span class="nv">frame</span> <span class="nv">base-cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="nv">frame</span> <span class="nv">base-cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">cenv-first-frame</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">enclosing-cenv</span> <span class="nv">cenv</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">cenv</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">find-variable</span> <span class="nv">var</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">env-loop</span> <span class="nv">frame-num</span> <span class="nv">cenv</span><span class="p">)</span>
	<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">scan</span> <span class="nv">displacement</span> <span class="nv">vars</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">vars</span><span class="p">)</span>
			 <span class="p">(</span><span class="nf">env-loop</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">frame-num</span> <span class="mi">1</span><span class="p">)</span>
					   <span class="p">(</span><span class="nf">enclosing-cenv</span> <span class="nv">cenv</span><span class="p">)))</span>
			<span class="p">((</span><span class="nb">eq?</span> <span class="nv">var</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">vars</span><span class="p">))</span>
			 <span class="p">(</span><span class="nf">make-lexical-address</span> <span class="nv">frame-num</span>
								   <span class="nv">displacement</span><span class="p">))</span>
			<span class="p">(</span><span class="k">else</span>
			 <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="nv">displacement</span><span class="p">)</span>
				   <span class="p">(</span><span class="nb">cdr</span> <span class="nv">vars</span><span class="p">)))))</span>
	<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">cenv</span> <span class="nv">the-empty-cenv</span><span class="p">)</span>
		<span class="ss">'not-found</span>
		<span class="p">(</span><span class="nf">scan</span> <span class="mi">0</span> <span class="p">(</span><span class="nf">cenv-first-frame</span> <span class="nv">cenv</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">env-loop</span> <span class="mi">0</span> <span class="nv">cenv</span><span class="p">))</span>
<span class="c1">;;;SECTION 5.5.3</span>

<span class="c1">;;;combinations</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-specialform-apply</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">proc-code</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">specialform-apply-procedure</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'proc</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">args-code</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">specialform-apply-arguments</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'argl</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">continue</span><span class="p">)</span>
     <span class="nv">proc-code</span>
     <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span> <span class="nv">continue</span><span class="p">)</span>
				 <span class="nv">args-code</span>
				 <span class="p">(</span><span class="nf">compile-procedure-call</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-application</span> <span class="nv">exp</span> <span class="nv">target</span> <span class="nv">linkage</span> <span class="nv">cenv</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">proc-code</span> <span class="p">(</span><span class="nf">compile</span> <span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'proc</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">operand-codes</span>
         <span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">operand</span><span class="p">)</span> <span class="p">(</span><span class="nf">compile</span> <span class="nv">operand</span> <span class="ss">'val</span> <span class="ss">'next</span> <span class="nv">cenv</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">continue</span><span class="p">)</span>
     <span class="nv">proc-code</span>
     <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span> <span class="nv">continue</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">construct-arglist</span> <span class="nv">operand-codes</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">compile-procedure-call</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">construct-arglist</span> <span class="nv">operand-codes</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">operand-codes</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nv">operand-codes</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">operand-codes</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">(</span><span class="nf">argl</span><span class="p">)</span>
         <span class="o">'</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">argl</span> <span class="p">(</span><span class="nf">const</span> <span class="p">()))))</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">code-to-get-last-arg</span>
               <span class="p">(</span><span class="nf">append-instruction-sequences</span>
                <span class="p">(</span><span class="nb">car</span> <span class="nv">operand-codes</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">val</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">argl</span><span class="p">)</span>
                 <span class="o">'</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">argl</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">list</span><span class="p">)</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">)))))))</span>
          <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">operand-codes</span><span class="p">))</span>
              <span class="nv">code-to-get-last-arg</span>
              <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span><span class="p">)</span>
               <span class="nv">code-to-get-last-arg</span>
               <span class="p">(</span><span class="nf">code-to-get-rest-args</span>
                <span class="p">(</span><span class="nb">cdr</span> <span class="nv">operand-codes</span><span class="p">))))))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">code-to-get-rest-args</span> <span class="nv">operand-codes</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">code-for-next-arg</span>
         <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">argl</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">car</span> <span class="nv">operand-codes</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">val</span> <span class="nv">argl</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">argl</span><span class="p">)</span>
           <span class="o">'</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">argl</span>
              <span class="p">(</span><span class="nf">op</span> <span class="nv">cons</span><span class="p">)</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">)</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">argl</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">operand-codes</span><span class="p">))</span>
        <span class="nv">code-for-next-arg</span>
        <span class="p">(</span><span class="nf">preserving</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span><span class="p">)</span>
         <span class="nv">code-for-next-arg</span>
         <span class="p">(</span><span class="nf">code-to-get-rest-args</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">operand-codes</span><span class="p">))))))</span>

<span class="c1">;;;applying procedures</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-procedure-call</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">primitive-branch</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'primitive-branch</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">compiled-branch</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'compiled-branch</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">after-call</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'after-call</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">compiled-linkage</span>
           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'next</span><span class="p">)</span> <span class="nv">after-call</span> <span class="nv">linkage</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">append-instruction-sequences</span>
       <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span><span class="p">)</span> <span class="o">'</span><span class="p">()</span>
        <span class="o">`</span><span class="p">((</span><span class="nf">test</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">primitive-procedure?</span><span class="p">)</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">proc</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">branch</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">primitive-branch</span><span class="p">))))</span>
       <span class="p">(</span><span class="nf">parallel-instruction-sequences</span>
        <span class="p">(</span><span class="nf">append-instruction-sequences</span>
         <span class="nv">compiled-branch</span>
         <span class="p">(</span><span class="nf">compile-proc-appl</span> <span class="nv">target</span> <span class="nv">compiled-linkage</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">append-instruction-sequences</span>
         <span class="nv">primitive-branch</span>
         <span class="p">(</span><span class="nf">end-with-linkage</span> <span class="nv">linkage</span>
          <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span> <span class="nv">argl</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nb">list</span> <span class="nv">target</span><span class="p">)</span>
           <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span>
                     <span class="p">(</span><span class="nf">op</span> <span class="nv">apply-primitive-procedure</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">reg</span> <span class="nv">proc</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">reg</span> <span class="nv">argl</span><span class="p">)))))))</span>
       <span class="nv">after-call</span><span class="p">))))</span>

<span class="c1">;;this procedure contains some modification in compiler for ex-5.47,5.48</span>
<span class="c1">;;but commented for ex-5.49 to use the original procedure without these changes.</span>
<span class="c1">;; (define (compile-procedure-call target linkage)</span>
<span class="c1">;;   (let ((primitive-branch (make-label 'primitive-branch))</span>
<span class="c1">;;         (compiled-branch (make-label 'compiled-branch))</span>
<span class="c1">;;         (compound-branch (make-label 'compound-branch))</span>
<span class="c1">;;         (after-call (make-label 'after-call)))</span>
<span class="c1">;;     (let ((compiled-or-compound-linkage</span>
<span class="c1">;;            (if (eq? linkage 'next) after-call linkage)))</span>
<span class="c1">;;       (append-instruction-sequences</span>
<span class="c1">;;        (make-instruction-sequence '(proc) '()</span>
<span class="c1">;;         `((test (op primitive-procedure?) (reg proc))</span>
<span class="c1">;;           (branch (label ,primitive-branch))))</span>
<span class="c1">;;        (parallel-instruction-sequences</span>
<span class="c1">;; 		(append-instruction-sequences</span>
<span class="c1">;; 		 (make-instruction-sequence '(proc) '()</span>
<span class="c1">;; 		  `((test (op compound-procedure?) (reg proc))</span>
<span class="c1">;; 			(branch (label ,compound-branch))))</span>
<span class="c1">;; 		 (parallel-instruction-sequences</span>
<span class="c1">;; 		  (append-instruction-sequences</span>
<span class="c1">;;            compiled-branch</span>
<span class="c1">;;            (compile-proc-appl target compiled-or-compound-linkage))</span>
<span class="c1">;; 		  (append-instruction-sequences</span>
<span class="c1">;; 		   compound-branch</span>
<span class="c1">;; 		   (compound-proc-appl target compiled-or-compound-linkage))))</span>
<span class="c1">;;         (append-instruction-sequences</span>
<span class="c1">;;          primitive-branch</span>
<span class="c1">;;          (end-with-linkage linkage</span>
<span class="c1">;;           (make-instruction-sequence '(proc argl)</span>
<span class="c1">;;                                      (list target)</span>
<span class="c1">;;            `((assign ,target</span>
<span class="c1">;;                      (op apply-primitive-procedure)</span>
<span class="c1">;;                      (reg proc)</span>
<span class="c1">;;                      (reg argl)))))))</span>
<span class="c1">;;        after-call))))</span>

<span class="c1">;;;applying compound procedures</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compound-proc-appl</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">target</span> <span class="ss">'val</span><span class="p">)</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">)))</span>
         <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span><span class="p">)</span> <span class="nv">all-regs</span>
			<span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">continue</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">linkage</span><span class="p">))</span>
			  <span class="p">(</span><span class="nf">save</span> <span class="nv">continue</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">compapp</span><span class="p">)))))</span>
        <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">target</span> <span class="ss">'val</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">)))</span>
         <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">proc-return</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'proc-return</span><span class="p">)))</span>
           <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span><span class="p">)</span> <span class="nv">all-regs</span>
            <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">continue</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">proc-return</span><span class="p">))</span>
			  <span class="p">(</span><span class="nf">save</span> <span class="nv">continue</span><span class="p">)</span>
			  <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">compapp</span><span class="p">))</span>
              <span class="o">,</span><span class="nv">proc-return</span>
              <span class="p">(</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">linkage</span><span class="p">))))))</span>
        <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">target</span> <span class="ss">'val</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span> <span class="nv">continue</span><span class="p">)</span> <span class="nv">all-regs</span>
          <span class="o">'</span><span class="p">((</span><span class="nf">save</span> <span class="nv">continue</span><span class="p">)</span>
			<span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">compapp</span><span class="p">)))))</span>
        <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">target</span> <span class="ss">'val</span><span class="p">))</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">error</span> <span class="s">"return linkage, target not val -- COMPILE"</span>
                <span class="nv">target</span><span class="p">))))</span>

<span class="c1">;;;applying compiled procedures</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-proc-appl</span> <span class="nv">target</span> <span class="nv">linkage</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">target</span> <span class="ss">'val</span><span class="p">)</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">)))</span>
         <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span><span class="p">)</span> <span class="nv">all-regs</span>
           <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">continue</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">linkage</span><span class="p">))</span>
             <span class="p">(</span><span class="nf">assign</span> <span class="nv">val</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">compiled-procedure-entry</span><span class="p">)</span>
                         <span class="p">(</span><span class="nf">reg</span> <span class="nv">proc</span><span class="p">))</span>
             <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">)))))</span>
        <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">target</span> <span class="ss">'val</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">)))</span>
         <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">proc-return</span> <span class="p">(</span><span class="nf">make-label</span> <span class="ss">'proc-return</span><span class="p">)))</span>
           <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span><span class="p">)</span> <span class="nv">all-regs</span>
            <span class="o">`</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">continue</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">proc-return</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">assign</span> <span class="nv">val</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">compiled-procedure-entry</span><span class="p">)</span>
                          <span class="p">(</span><span class="nf">reg</span> <span class="nv">proc</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">))</span>
              <span class="o">,</span><span class="nv">proc-return</span>
              <span class="p">(</span><span class="nf">assign</span> <span class="o">,</span><span class="nv">target</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">label</span> <span class="o">,</span><span class="nv">linkage</span><span class="p">))))))</span>
        <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">target</span> <span class="ss">'val</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">make-instruction-sequence</span> <span class="o">'</span><span class="p">(</span><span class="nf">proc</span> <span class="nv">continue</span><span class="p">)</span> <span class="nv">all-regs</span>
          <span class="o">'</span><span class="p">((</span><span class="nf">assign</span> <span class="nv">val</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">compiled-procedure-entry</span><span class="p">)</span>
                        <span class="p">(</span><span class="nf">reg</span> <span class="nv">proc</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">goto</span> <span class="p">(</span><span class="nf">reg</span> <span class="nv">val</span><span class="p">)))))</span>
        <span class="p">((</span><span class="k">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">target</span> <span class="ss">'val</span><span class="p">))</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">linkage</span> <span class="ss">'return</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">error</span> <span class="s">"return linkage, target not val -- COMPILE"</span>
                <span class="nv">target</span><span class="p">))))</span>

<span class="c1">;; footnote</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">all-regs</span> <span class="o">'</span><span class="p">(</span><span class="nf">env</span> <span class="nv">proc</span> <span class="nv">val</span> <span class="nv">argl</span> <span class="nv">continue</span><span class="p">))</span>


<span class="c1">;;;SECTION 5.5.4</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">registers-needed</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">symbol?</span> <span class="nv">s</span><span class="p">)</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">symbol?</span> <span class="nv">s</span><span class="p">)</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">s</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">statements</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">symbol?</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr</span> <span class="nv">s</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">needs-register?</span> <span class="nv">seq</span> <span class="nv">reg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">memq</span> <span class="nv">reg</span> <span class="p">(</span><span class="nf">registers-needed</span> <span class="nv">seq</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">modifies-register?</span> <span class="nv">seq</span> <span class="nv">reg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">memq</span> <span class="nv">reg</span> <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">seq</span><span class="p">)))</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">append-instruction-sequences</span> <span class="o">.</span> <span class="nv">seqs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">append-2-sequences</span> <span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-instruction-sequence</span>
     <span class="p">(</span><span class="nf">list-union</span> <span class="p">(</span><span class="nf">registers-needed</span> <span class="nv">seq1</span><span class="p">)</span>
                 <span class="p">(</span><span class="nf">list-difference</span> <span class="p">(</span><span class="nf">registers-needed</span> <span class="nv">seq2</span><span class="p">)</span>
                                  <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">seq1</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">list-union</span> <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">seq1</span><span class="p">)</span>
                 <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">seq2</span><span class="p">))</span>
     <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nf">statements</span> <span class="nv">seq1</span><span class="p">)</span> <span class="p">(</span><span class="nf">statements</span> <span class="nv">seq2</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">append-seq-list</span> <span class="nv">seqs</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">seqs</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">empty-instruction-sequence</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">append-2-sequences</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">seqs</span><span class="p">)</span>
                            <span class="p">(</span><span class="nf">append-seq-list</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">seqs</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">append-seq-list</span> <span class="nv">seqs</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">list-union</span> <span class="nv">s1</span> <span class="nv">s2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">s1</span><span class="p">)</span> <span class="nv">s2</span><span class="p">)</span>
        <span class="p">((</span><span class="nb">memq</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s1</span><span class="p">)</span> <span class="nv">s2</span><span class="p">)</span> <span class="p">(</span><span class="nf">list-union</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s1</span><span class="p">)</span> <span class="nv">s2</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s1</span><span class="p">)</span> <span class="p">(</span><span class="nf">list-union</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s1</span><span class="p">)</span> <span class="nv">s2</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">list-difference</span> <span class="nv">s1</span> <span class="nv">s2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">s1</span><span class="p">)</span> <span class="o">'</span><span class="p">())</span>
        <span class="p">((</span><span class="nb">memq</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s1</span><span class="p">)</span> <span class="nv">s2</span><span class="p">)</span> <span class="p">(</span><span class="nf">list-difference</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s1</span><span class="p">)</span> <span class="nv">s2</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s1</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">list-difference</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s1</span><span class="p">)</span> <span class="nv">s2</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">preserving</span> <span class="nv">regs</span> <span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">regs</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">append-instruction-sequences</span> <span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">first-reg</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">regs</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">needs-register?</span> <span class="nv">seq2</span> <span class="nv">first-reg</span><span class="p">)</span>
                 <span class="p">(</span><span class="nf">modifies-register?</span> <span class="nv">seq1</span> <span class="nv">first-reg</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">preserving</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">regs</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">make-instruction-sequence</span>
              <span class="p">(</span><span class="nf">list-union</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">first-reg</span><span class="p">)</span>
                          <span class="p">(</span><span class="nf">registers-needed</span> <span class="nv">seq1</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">list-difference</span> <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">seq1</span><span class="p">)</span>
                               <span class="p">(</span><span class="nb">list</span> <span class="nv">first-reg</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">append</span> <span class="o">`</span><span class="p">((</span><span class="nf">save</span> <span class="o">,</span><span class="nv">first-reg</span><span class="p">))</span>
                      <span class="p">(</span><span class="nf">statements</span> <span class="nv">seq1</span><span class="p">)</span>
                      <span class="o">`</span><span class="p">((</span><span class="nf">restore</span> <span class="o">,</span><span class="nv">first-reg</span><span class="p">))))</span>
             <span class="nv">seq2</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">preserving</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">regs</span><span class="p">)</span> <span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">tack-on-instruction-sequence</span> <span class="nv">seq</span> <span class="nv">body-seq</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-instruction-sequence</span>
   <span class="p">(</span><span class="nf">registers-needed</span> <span class="nv">seq</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">seq</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nf">statements</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nf">statements</span> <span class="nv">body-seq</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">parallel-instruction-sequences</span> <span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-instruction-sequence</span>
   <span class="p">(</span><span class="nf">list-union</span> <span class="p">(</span><span class="nf">registers-needed</span> <span class="nv">seq1</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">registers-needed</span> <span class="nv">seq2</span><span class="p">))</span>
   <span class="p">(</span><span class="nf">list-union</span> <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">seq1</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">registers-modified</span> <span class="nv">seq2</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nf">statements</span> <span class="nv">seq1</span><span class="p">)</span> <span class="p">(</span><span class="nf">statements</span> <span class="nv">seq2</span><span class="p">))))</span>

<span class="o">'</span><span class="p">(</span><span class="nf">COMPILER</span> <span class="nv">LOADED</span><span class="p">)</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Code in file ch5-eceval-support:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
</pre></td><td class="code"><pre><span class="c1">;;;;SIMULATION OF ECEVAL MACHINE OPERATIONS --</span>
<span class="c1">;;;;loaded by load-eceval.scm and by load-eceval-compiler.scm</span>

<span class="c1">;;;;FIRST A LOT FROM 4.1.2-4.1.4</span>

<span class="p">(</span><span class="nb">load</span> <span class="s">"ch5-syntax.scm"</span><span class="p">)</span><span class="c1">;               ;section 4.1.2 syntax procedures</span>

<span class="c1">;;;SECTION 4.1.3</span>
<span class="c1">;;; operations used by compiled code and eceval except as noted</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">true?</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">x</span> <span class="nv">false</span><span class="p">)))</span>

<span class="c1">;;* not used by eceval itself -- used by compiled code when that</span>
<span class="c1">;; is run in the eceval machine</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">false?</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">eq?</span> <span class="nv">x</span> <span class="nv">false</span><span class="p">))</span>

<span class="c1">;;following compound-procedure operations not used by compiled code</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-procedure</span> <span class="nv">parameters</span> <span class="nv">body</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list</span> <span class="ss">'procedure</span> <span class="nv">parameters</span> <span class="nv">body</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compound-procedure?</span> <span class="nv">p</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">p</span> <span class="ss">'procedure</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">procedure-parameters</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">p</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">procedure-body</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr</span> <span class="nv">p</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">procedure-environment</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadddr</span> <span class="nv">p</span><span class="p">))</span>
<span class="c1">;;(end of compound procedures)</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">enclosing-environment</span> <span class="nv">env</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">first-frame</span> <span class="nv">env</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">the-empty-environment</span> <span class="o">'</span><span class="p">())</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-frame</span> <span class="nv">variables</span> <span class="nv">values</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="nv">variables</span> <span class="nv">values</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">frame-variables</span> <span class="nv">frame</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">frame-values</span> <span class="nv">frame</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">frame</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">add-binding-to-frame!</span> <span class="nv">var</span> <span class="nv">val</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">set-car!</span> <span class="nv">frame</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">var</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">frame</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">set-cdr!</span> <span class="nv">frame</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">val</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">frame</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">extend-environment</span> <span class="nv">vars</span> <span class="nv">vals</span> <span class="nv">base-env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">=</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">vals</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nf">make-frame</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span> <span class="nv">base-env</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">vals</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">error</span> <span class="s">"Too many arguments supplied"</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">error</span> <span class="s">"Too few arguments supplied"</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">))))</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lookup-variable-value</span> <span class="nv">var</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">env-loop</span> <span class="nv">env</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">scan</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">vars</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">env-loop</span> <span class="p">(</span><span class="nf">enclosing-environment</span> <span class="nv">env</span><span class="p">)))</span>
            <span class="p">((</span><span class="nb">eq?</span> <span class="nv">var</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">vars</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">car</span> <span class="nv">vals</span><span class="p">))</span>
            <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">vals</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">env</span> <span class="nv">the-empty-environment</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">error</span> <span class="s">"Unbound variable"</span> <span class="nv">var</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">frame</span> <span class="p">(</span><span class="nf">first-frame</span> <span class="nv">env</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nf">frame-variables</span> <span class="nv">frame</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">frame-values</span> <span class="nv">frame</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">env-loop</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">set-variable-value!</span> <span class="nv">var</span> <span class="nv">val</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">env-loop</span> <span class="nv">env</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">scan</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">vars</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">env-loop</span> <span class="p">(</span><span class="nf">enclosing-environment</span> <span class="nv">env</span><span class="p">)))</span>
            <span class="p">((</span><span class="nb">eq?</span> <span class="nv">var</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">vars</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">set-car!</span> <span class="nv">vals</span> <span class="nv">val</span><span class="p">))</span>
            <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">vals</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">env</span> <span class="nv">the-empty-environment</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">error</span> <span class="s">"Unbound variable -- SET!"</span> <span class="nv">var</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">frame</span> <span class="p">(</span><span class="nf">first-frame</span> <span class="nv">env</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nf">frame-variables</span> <span class="nv">frame</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">frame-values</span> <span class="nv">frame</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">env-loop</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">define-variable!</span> <span class="nv">var</span> <span class="nv">val</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">frame</span> <span class="p">(</span><span class="nf">first-frame</span> <span class="nv">env</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">scan</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">vars</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">add-binding-to-frame!</span> <span class="nv">var</span> <span class="nv">val</span> <span class="nv">frame</span><span class="p">))</span>
            <span class="p">((</span><span class="nb">eq?</span> <span class="nv">var</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">vars</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">set-car!</span> <span class="nv">vals</span> <span class="nv">val</span><span class="p">))</span>
            <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">vals</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nf">frame-variables</span> <span class="nv">frame</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">frame-values</span> <span class="nv">frame</span><span class="p">))))</span>

<span class="c1">;;;SECTION 4.1.4</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">setup-environment</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">initial-env</span>
         <span class="p">(</span><span class="nf">extend-environment</span> <span class="p">(</span><span class="nf">primitive-procedure-names</span><span class="p">)</span>
                             <span class="p">(</span><span class="nf">primitive-procedure-objects</span><span class="p">)</span>
                             <span class="nv">the-empty-environment</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">define-variable!</span> <span class="ss">'true</span> <span class="nv">true</span> <span class="nv">initial-env</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-variable!</span> <span class="ss">'false</span> <span class="nv">false</span> <span class="nv">initial-env</span><span class="p">)</span>

    <span class="nv">initial-env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">primitive-procedure?</span> <span class="nv">proc</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">proc</span> <span class="ss">'primitive</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">primitive-implementation</span> <span class="nv">proc</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">proc</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">primitive-procedures</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'car</span> <span class="nv">car</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'cdr</span> <span class="nv">cdr</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'cons</span> <span class="nv">cons</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list</span> <span class="ss">'null?</span> <span class="nv">null?</span><span class="p">)</span>
	<span class="c1">;;above from book -- here are some more</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'+</span> <span class="nv">+</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'-</span> <span class="nv">-</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'*</span> <span class="nv">*</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'=</span> <span class="nv">=</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'/</span> <span class="nv">/</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'&gt;</span> <span class="nv">&gt;</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'&lt;</span> <span class="nv">&lt;</span><span class="p">)</span>

	<span class="c1">;;procedures added for ex-5.50</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'list</span> <span class="nv">list</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'length</span> <span class="nv">length</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cddr</span> <span class="nv">cddr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cadr</span> <span class="nv">cadr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cdar</span> <span class="nv">cdar</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cdddr</span> <span class="nv">cdddr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cdadr</span> <span class="nv">cdadr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cddar</span> <span class="nv">cddar</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'caddr</span> <span class="nv">caddr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'caadr</span> <span class="nv">caadr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'cadddr</span> <span class="nv">cadddr</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">'set-car!</span> <span class="nv">set-car!</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'set-cdr!</span> <span class="nv">set-cdr!</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'newline</span> <span class="nv">newline</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'display</span> <span class="nv">display</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'error</span> <span class="nv">error</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'read</span> <span class="nv">read</span><span class="p">)</span>
	<span class="c1">;; (list 'apply (lambda (proc args)</span>
	<span class="c1">;; 			   (apply (primitive-implementation proc) args)))</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'eq?</span> <span class="nv">eq?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'number?</span> <span class="nv">number?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'symbol?</span> <span class="nv">symbol?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'pair?</span> <span class="nv">pair?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'string?</span> <span class="nv">string?</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list</span> <span class="ss">'not</span> <span class="nv">not</span><span class="p">)</span>
		<span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">primitive-procedure-names</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map</span> <span class="nv">car</span>
       <span class="nv">primitive-procedures</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">primitive-procedure-objects</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">proc</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'primitive</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">proc</span><span class="p">)))</span>
       <span class="nv">primitive-procedures</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">apply-in-underlying-scheme</span> <span class="nv">apply</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">apply-primitive-procedure</span> <span class="nv">proc</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-in-underlying-scheme</span>
   <span class="p">(</span><span class="nf">primitive-implementation</span> <span class="nv">proc</span><span class="p">)</span> <span class="nv">args</span><span class="p">))</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">prompt-for-input</span> <span class="nv">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">display</span> <span class="nv">string</span><span class="p">)</span> <span class="p">(</span><span class="nb">newline</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">announce-output</span> <span class="nv">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">display</span> <span class="nv">string</span><span class="p">)</span> <span class="p">(</span><span class="nb">newline</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">user-print</span> <span class="nv">object</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">compound-procedure?</span> <span class="nv">object</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'compound-procedure</span>
                     <span class="p">(</span><span class="nf">procedure-parameters</span> <span class="nv">object</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">procedure-body</span> <span class="nv">object</span><span class="p">)</span>
                     <span class="ss">'&lt;procedure-env&gt;</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">display</span> <span class="nv">object</span><span class="p">)))</span>

<span class="c1">;;; Simulation of new machine operations needed by</span>
<span class="c1">;;;  eceval machine (not used by compiled code)</span>

<span class="c1">;;; From section 5.4.1 footnote</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">empty-arglist</span><span class="p">)</span> <span class="o">'</span><span class="p">())</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">adjoin-arg</span> <span class="nv">arg</span> <span class="nv">arglist</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">append</span> <span class="nv">arglist</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">arg</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">last-operand?</span> <span class="nv">ops</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">ops</span><span class="p">)))</span>

<span class="c1">;;; From section 5.4.2 footnote, for non-tail-recursive sequences</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">no-more-exps?</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">seq</span><span class="p">))</span>

<span class="c1">;;; From section 5.4.4 footnote</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">get-global-environment</span><span class="p">)</span>
  <span class="nv">the-global-environment</span><span class="p">)</span>
<span class="c1">;; will do following when ready to run, not when load this file</span>
<span class="c1">;;(define the-global-environment (setup-environment))</span>


<span class="c1">;;; Simulation of new machine operations needed for compiled code</span>
<span class="c1">;;;  and eceval/compiler interface (not used by plain eceval machine)</span>
<span class="c1">;;; From section 5.5.2 footnote</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-compiled-procedure</span> <span class="nv">entry</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list</span> <span class="ss">'compiled-procedure</span> <span class="nv">entry</span> <span class="nv">env</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compiled-procedure?</span> <span class="nv">proc</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">proc</span> <span class="ss">'compiled-procedure</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compiled-procedure-entry</span> <span class="nv">c-proc</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">c-proc</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compiled-procedure-env</span> <span class="nv">c-proc</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr</span> <span class="nv">c-proc</span><span class="p">))</span>

<span class="c1">;;;ex-5.25 normal order evaluation</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">delay-it</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list</span> <span class="ss">'thunk</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">thunk?</span> <span class="nv">obj</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">obj</span> <span class="ss">'thunk</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">thunk-exp</span> <span class="nv">thunk</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">thunk</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">thunk-env</span> <span class="nv">thunk</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr</span> <span class="nv">thunk</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">evaluated-thunk?</span> <span class="nv">obj</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">obj</span> <span class="ss">'evaluated-thunk</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">thunk-value</span> <span class="nv">evaluated-thunk</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">evaluated-thunk</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-evaluated-thunk</span> <span class="nv">thunk</span> <span class="nv">thunk-value</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">set-car!</span> <span class="nv">thunk</span> <span class="ss">'evaluated-thunk</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">set-car!</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">thunk</span><span class="p">)</span> <span class="nv">thunk-value</span><span class="p">)</span>  <span class="c1">; replace exp with its value</span>
  <span class="p">(</span><span class="nb">set-cdr!</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">thunk</span><span class="p">)</span> <span class="o">'</span><span class="p">()))</span>     <span class="c1">; forget unneeded env</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">list-of-delayed-args</span> <span class="nv">exps</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">no-operands?</span> <span class="nv">exps</span><span class="p">)</span>
      <span class="o">'</span><span class="p">()</span>
      <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nf">delay-it</span> <span class="p">(</span><span class="nf">first-operand</span> <span class="nv">exps</span><span class="p">)</span> <span class="nv">env</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">list-of-delayed-args</span> <span class="p">(</span><span class="nf">rest-operands</span> <span class="nv">exps</span><span class="p">)</span>
                                  <span class="nv">env</span><span class="p">))))</span>

<span class="c1">;;ex-5.39</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-lexical-address</span> <span class="nv">frame-num</span> <span class="nv">elem-num</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nv">frame-num</span> <span class="nv">elem-num</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lex-addr-frame-num</span> <span class="nv">lexical-address</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car</span> <span class="nv">lexical-address</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lex-addr-displacement</span> <span class="nv">lexical-address</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cadr</span> <span class="nv">lexical-address</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lexical-address-lookup</span> <span class="nv">lex-addr</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">correct-env</span> <span class="p">(</span><span class="nf">env-ref</span> <span class="nv">env</span>
							  <span class="p">(</span><span class="nf">lex-addr-frame-num</span> <span class="nv">lex-addr</span><span class="p">))))</span>
	<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">elem</span> <span class="p">(</span><span class="nb">list-ref</span> <span class="p">(</span><span class="nf">frame-values</span>
						   <span class="p">(</span><span class="nf">first-frame</span> <span class="nv">correct-env</span><span class="p">))</span>
						  <span class="p">(</span><span class="nf">lex-addr-displacement</span> <span class="nv">lex-addr</span><span class="p">))))</span>
	  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="nv">elem</span> <span class="ss">'*unassigned*</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">error</span> <span class="s">"Error - Unassigned variable access!"</span><span class="p">)</span>
		  <span class="nv">elem</span><span class="p">))))</span>
  
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lexical-address-set!</span> <span class="nv">lex-addr</span> <span class="nv">val</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">correct-env</span> <span class="p">(</span><span class="nf">env-ref</span> <span class="nv">env</span>
							  <span class="p">(</span><span class="nf">lex-addr-frame-num</span> <span class="nv">lex-addr</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">list-set!</span> <span class="p">(</span><span class="nf">frame-values</span>
				<span class="p">(</span><span class="nf">first-frame</span> <span class="nv">correct-env</span><span class="p">))</span>
			   <span class="p">(</span><span class="nf">lex-addr-displacement</span> <span class="nv">lex-addr</span><span class="p">)</span>
			   <span class="nv">val</span><span class="p">)</span>
	<span class="ss">'ok</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">env-ref</span> <span class="nv">env</span> <span class="nv">frame-num</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">eq?</span> <span class="nv">env</span> <span class="nv">the-empty-environment</span><span class="p">)</span>
		 <span class="p">(</span><span class="nf">error</span> <span class="s">"Invalid environment!"</span><span class="p">))</span>
		<span class="p">((</span><span class="nb">=</span> <span class="nv">frame-num</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">env</span><span class="p">)</span>
		<span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nf">env-ref</span>
			   <span class="p">(</span><span class="nf">enclosing-environment</span> <span class="nv">env</span><span class="p">)</span>
			   <span class="p">(</span><span class="nb">-</span> <span class="nv">frame-num</span> <span class="mi">1</span><span class="p">)))))</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Complete code of syntax file, ch5-syntax.scm:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
</pre></td><td class="code"><pre><span class="c1">;;;;SCHEME SYNTAX FROM SECTION 4.1.2 OF STRUCTURE AND INTERPRETATION OF</span>
<span class="c1">;;;  COMPUTER PROGRAMS, TO SUPPORT CHAPTER 5</span>
<span class="c1">;;;;Loaded by compiler.scm (for use by compiler), and by eceval-support.scm</span>
<span class="c1">;;;; (for simulation of eceval machine operations)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">self-evaluating?</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">number?</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">true</span><span class="p">)</span>
        <span class="p">((</span><span class="nb">string?</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">true</span><span class="p">)</span>
		<span class="p">((</span><span class="nb">null?</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">true</span><span class="p">)</span>
        <span class="p">(</span><span class="k">else</span> <span class="nv">false</span><span class="p">)))</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">quoted?</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'quote</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">text-of-quotation</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="nv">tag</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">pair?</span> <span class="nv">exp</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">eq?</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">tag</span><span class="p">)</span>
      <span class="nv">false</span><span class="p">))</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">variable?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">symbol?</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">assignment?</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'set!</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">assignment-variable</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">assignment-value</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr</span> <span class="nv">exp</span><span class="p">))</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">definition?</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'define</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">definition-variable</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">symbol?</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">caadr</span> <span class="nv">exp</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">definition-value</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">symbol?</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">caddr</span> <span class="nv">exp</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-lambda</span> <span class="p">(</span><span class="nb">cdadr</span> <span class="nv">exp</span><span class="p">)</span>
                   <span class="p">(</span><span class="nb">cddr</span> <span class="nv">exp</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lambda?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'lambda</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lambda-parameters</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">lambda-body</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cddr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-lambda</span> <span class="nv">parameters</span> <span class="nv">body</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="ss">'lambda</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">parameters</span> <span class="nv">body</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">if?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'if</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">if-predicate</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">if-consequent</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">if-alternative</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdddr</span> <span class="nv">exp</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">cadddr</span> <span class="nv">exp</span><span class="p">)</span>
      <span class="ss">'false</span><span class="p">))</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">begin?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'begin</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">begin-actions</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">last-exp?</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">seq</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">first-exp</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">seq</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">rest-exps</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">seq</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">application?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">pair?</span> <span class="nv">exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">no-operands?</span> <span class="nv">ops</span><span class="p">)</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">ops</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">first-operand</span> <span class="nv">ops</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">ops</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">rest-operands</span> <span class="nv">ops</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">ops</span><span class="p">))</span>

<span class="c1">;;;**following needed only to implement COND as derived expression,</span>
<span class="c1">;;; not needed by eceval machine in text.  But used by compiler</span>

<span class="c1">;; from 4.1.2</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-if</span> <span class="nv">predicate</span> <span class="nv">consequent</span> <span class="nv">alternative</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list</span> <span class="ss">'if</span> <span class="nv">predicate</span> <span class="nv">consequent</span> <span class="nv">alternative</span><span class="p">))</span>


<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">sequence-&gt;exp</span> <span class="nv">seq</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">seq</span><span class="p">)</span> <span class="nv">seq</span><span class="p">)</span>
        <span class="p">((</span><span class="nf">last-exp?</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nf">first-exp</span> <span class="nv">seq</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nf">make-begin</span> <span class="nv">seq</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-begin</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">'begin</span> <span class="nv">seq</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">cond?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'cond</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">cond-clauses</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">cond-else-clause?</span> <span class="nv">clause</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">eq?</span> <span class="p">(</span><span class="nf">cond-predicate</span> <span class="nv">clause</span><span class="p">)</span> <span class="ss">'else</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">cond-predicate</span> <span class="nv">clause</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">clause</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">cond-actions</span> <span class="nv">clause</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">clause</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">cond-&gt;if</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">expand-clauses</span> <span class="p">(</span><span class="nf">cond-clauses</span> <span class="nv">exp</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">expand-clauses</span> <span class="nv">clauses</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">clauses</span><span class="p">)</span>
      <span class="ss">'false</span>                          <span class="c1">; no else clause</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">first</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">clauses</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">rest</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">clauses</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">cond-else-clause?</span> <span class="nv">first</span><span class="p">)</span>
            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">rest</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">sequence-&gt;exp</span> <span class="p">(</span><span class="nf">cond-actions</span> <span class="nv">first</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">error</span> <span class="s">"ELSE clause isn't last -- COND-&gt;IF"</span>
                       <span class="nv">clauses</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">make-if</span> <span class="p">(</span><span class="nf">cond-predicate</span> <span class="nv">first</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">sequence-&gt;exp</span> <span class="p">(</span><span class="nf">cond-actions</span> <span class="nv">first</span><span class="p">))</span>
                     <span class="p">(</span><span class="nf">expand-clauses</span> <span class="nv">rest</span><span class="p">))))))</span>
<span class="c1">;; end of Cond support</span>

<span class="c1">;; var-defs and body should be list</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">make-let</span> <span class="nv">var-defs</span> <span class="nv">body</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="ss">'let</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">var-defs</span> <span class="nv">body</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">let?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'let</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">let-varexps</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">let-body</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cddr</span> <span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">let-&gt;combination</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">res</span> <span class="p">(</span><span class="nf">fold-right</span>
			  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">new</span> <span class="nv">rem</span><span class="p">)</span>
				<span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">new</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">rem</span><span class="p">))</span>
					  <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">new</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">rem</span><span class="p">))))</span>
			  <span class="p">(</span><span class="nb">cons</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">())</span>
			  <span class="p">(</span><span class="nf">let-varexps</span> <span class="nv">exp</span><span class="p">))))</span>
	<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">vars</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">res</span><span class="p">))</span>
		  <span class="p">(</span><span class="nf">vexps</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">res</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nf">make-lambda</span> <span class="nv">vars</span> <span class="p">(</span><span class="nf">let-body</span> <span class="nv">exp</span><span class="p">))</span> <span class="nv">vexps</span><span class="p">)</span>
	  <span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-and-run?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'compile-and-run</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">compile-and-run-expression</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">text-of-quotation</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">specialform-apply?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">'specialform-apply</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">specialform-apply-procedure</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">specialform-apply-arguments</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr</span> <span class="nv">exp</span><span class="p">))</span></pre></td></tr></tbody></table></code></pre></figure>

<hr />

<p>Yo!</p>

<p>That completes most of the exercises of sicp. As of now, i am skipping last two exercises :)</p>

                        <hr/>
                    </span>

                    <br/>

                    

	<div id="disqus_thread"></div>
	<script>
		/**
		 * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
		 * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
		 */
		var disqus_identifier = 'inchmeal';

		
		var disqus_config = function () {
		 //this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
		 this.page.identifier = "/sicp/ch-5/ex-5.50.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
		};
		


		(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//' + disqus_identifier + '.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>






                </article>
            </div><!-- /.small-11.columns -->
        </div><!-- /.row -->
    </div><!-- /.medium-8.columns -->
</div><!-- /.row -->


	    <div id="up-to-top" class="row">
      <div class="small-12 columns" style="text-align: right;">
        <a class="iconfont" title="Go to Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast')">&#xf108;</a>
      </div><!-- /.small-12.columns -->
    </div><!-- /.row -->

    <footer id="footer-content" class="bg-grau">
      <div id="subfooter">
        <nav class="row">
          <section id="subfooter-left" class="small-6 columns">
                <div class="column pl0 pr0">
                    <ul class="inline-list">
                        <li>Created with &hearts; by ovais</li>
                    </ul>
                </div>
                <div class="column pl0 pr0">
                    <ul class="inline-list">
                        
                        <li><a href="/rss-feed.xml"  target="_blank"  class="rss-link" title="Subscribe to RSS">RSS</a></li>
                        
                        <li><a href="mailto:mailovais85@gmail.com"  class="contact-link" title="Contact">Contact</a></li>
                        
                    </ul>
                </div>
              <div class="column pl0 pr0">
                  <ul class="inline-list">
                      <li>&copy;2018 inchmeal</li>
                  </ul>
              </div>
          </section>
          <section id="subfooter-right" class="small-6 columns social-icons end">
              <div class="column pl0 pr0">
              <ul class="inline-list">
                
                  <li><a href="http://twitter.com/0vai5" target="_blank" class="icon-twitter" title="Follow on twitter"></a></li>
                
                  <li><a href="http://github.com/0vais" target="_blank" class="icon-github" title="Follow on github"></a></li>
                
              </ul>
              </div>
          </section>
        </nav>
      </div><!-- /#subfooter -->
    </footer>


	<script src="https://www.inchmeal.io/assets/js/inchmeal_all.js"></script>

<script>
  var sectionName = "sicp";
  
  //google analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73233179-1', 'auto');
  ga('send', 'pageview');
  
</script>

</body>
</html>
